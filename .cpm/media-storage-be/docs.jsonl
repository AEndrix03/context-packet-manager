{"id": "README.md:markdown:0", "text": "# media-storage-be", "metadata": {"source_id": "README.md", "ext": ".md", "lang": "markdown", "chunker": "markdown", "block_count": 1, "blocks_meta": [{"kind": "md_child", "title": "heading:0", "lang": "markdown", "level": "child", "parent_id": "README.md:md:section:0:heading:0", "child_index": 0}], "path": "README.md"}}
{"id": "src/main/java/it/aredegalli/media/MediaStorageApplication.java:java:0", "text": "package it.aredegalli.media;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.boot.context.properties.ConfigurationPropertiesScan;\nimport org.springframework.scheduling.annotation.EnableScheduling;", "metadata": {"source_id": "src/main/java/it/aredegalli/media/MediaStorageApplication.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media;", "preamble": true, "block_count": 1, "blocks_meta": [{"kind": "preamble", "lang": "java", "level": "parent", "package": "package it.aredegalli.media;", "import_count": 4}], "path": "src/main/java/it/aredegalli/media/MediaStorageApplication.java"}}
{"id": "src/main/java/it/aredegalli/media/MediaStorageApplication.java:java:0", "text": "package it.aredegalli.media;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.boot.context.properties.ConfigurationPropertiesScan;\nimport org.springframework.scheduling.annotation.EnableScheduling;\n\n@SpringBootApplication\n@ConfigurationPropertiesScan\n@EnableScheduling\npublic class MediaStorageApplication {\n    // ... members ...\n}\n\n// ... code ...\n\npublic static void main(String[] args) {\n        SpringApplication.run(MediaStorageApplication.class, args);\n    }", "metadata": {"source_id": "src/main/java/it/aredegalli/media/MediaStorageApplication.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media;", "block_count": 1, "blocks_meta": [{"kind": "symbol_child", "node_type": "method_declaration", "symbol": "main", "qualified_name": "MediaStorageApplication.main", "symbol_class": "method", "lang": "java", "line_start": 13, "line_end": 15, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/MediaStorageApplication.java:java:method_declaration:MediaStorageApplication.main:13-15", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@SpringBootApplication\n@ConfigurationPropertiesScan\n@EnableScheduling\npublic class MediaStorageApplication {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.boot.context.properties.ConfigurationPropertiesScan;\nimport org.springframework.scheduling.annotation.EnableScheduling;"}], "path": "src/main/java/it/aredegalli/media/MediaStorageApplication.java"}}
{"id": "src/main/java/it/aredegalli/media/config/ActuatorConfig.java:java:0", "text": "package it.aredegalli.media.config;\n\nimport org.springframework.boot.actuate.health.DefaultHealthContributorRegistry;\nimport org.springframework.boot.actuate.health.HealthContributorRegistry;\nimport org.springframework.boot.actuate.health.SimpleStatusAggregator;\nimport org.springframework.boot.actuate.health.StatusAggregator;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport java.util.Collections;", "metadata": {"source_id": "src/main/java/it/aredegalli/media/config/ActuatorConfig.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.config;", "preamble": true, "block_count": 1, "blocks_meta": [{"kind": "preamble", "lang": "java", "level": "parent", "package": "package it.aredegalli.media.config;", "import_count": 7}], "path": "src/main/java/it/aredegalli/media/config/ActuatorConfig.java"}}
{"id": "src/main/java/it/aredegalli/media/config/ActuatorConfig.java:java:0", "text": "package it.aredegalli.media.config;\n\nimport org.springframework.boot.actuate.health.DefaultHealthContributorRegistry;\nimport org.springframework.boot.actuate.health.HealthContributorRegistry;\nimport org.springframework.boot.actuate.health.SimpleStatusAggregator;\nimport org.springframework.boot.actuate.health.StatusAggregator;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport java.util.Collections;\n\n@Configuration\npublic class ActuatorConfig {\n    // ... members ...\n}\n\n// ... code ...\n\n@Bean\n    public StatusAggregator statusAggregator() {\n        return new SimpleStatusAggregator();\n    }\n@Bean\n    public HealthContributorRegistry healthContributorRegistry() {\n        return new DefaultHealthContributorRegistry(Collections.emptyMap());\n    }", "metadata": {"source_id": "src/main/java/it/aredegalli/media/config/ActuatorConfig.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.config;", "block_count": 2, "blocks_meta": [{"kind": "symbol_child", "node_type": "method_declaration", "symbol": "statusAggregator", "qualified_name": "ActuatorConfig.statusAggregator", "symbol_class": "method", "lang": "java", "line_start": 15, "line_end": 18, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/config/ActuatorConfig.java:java:method_declaration:ActuatorConfig.statusAggregator:15-18", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Configuration\npublic class ActuatorConfig {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.config;\n\nimport org.springframework.boot.actuate.health.DefaultHealthContributorRegistry;\nimport org.springframework.boot.actuate.health.HealthContributorRegistry;\nimport org.springframework.boot.actuate.health.SimpleStatusAggregator;\nimport org.springframework.boot.actuate.health.StatusAggregator;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport java.util.Collections;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "healthContributorRegistry", "qualified_name": "ActuatorConfig.healthContributorRegistry", "symbol_class": "method", "lang": "java", "line_start": 20, "line_end": 23, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/config/ActuatorConfig.java:java:method_declaration:ActuatorConfig.healthContributorRegistry:20-23", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Configuration\npublic class ActuatorConfig {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.config;\n\nimport org.springframework.boot.actuate.health.DefaultHealthContributorRegistry;\nimport org.springframework.boot.actuate.health.HealthContributorRegistry;\nimport org.springframework.boot.actuate.health.SimpleStatusAggregator;\nimport org.springframework.boot.actuate.health.StatusAggregator;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport java.util.Collections;"}], "path": "src/main/java/it/aredegalli/media/config/ActuatorConfig.java"}}
{"id": "src/main/java/it/aredegalli/media/controller/StorageController.java:java:0", "text": "package it.aredegalli.media.controller;\n\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.StorageService;\nimport jakarta.validation.constraints.NotNull;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.http.HttpHeaders;\nimport org.springframework.http.MediaType;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.*;\nimport org.springframework.web.multipart.MultipartFile;\nimport org.springframework.web.servlet.mvc.method.annotation.StreamingResponseBody;\n\nimport java.io.IOException;\nimport java.io.InputStream;", "metadata": {"source_id": "src/main/java/it/aredegalli/media/controller/StorageController.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.controller;", "preamble": true, "block_count": 1, "blocks_meta": [{"kind": "preamble", "lang": "java", "level": "parent", "package": "package it.aredegalli.media.controller;", "import_count": 13}], "path": "src/main/java/it/aredegalli/media/controller/StorageController.java"}}
{"id": "src/main/java/it/aredegalli/media/controller/StorageController.java:java:0", "text": "package it.aredegalli.media.controller;\n\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.StorageService;\nimport jakarta.validation.constraints.NotNull;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.http.HttpHeaders;\nimport org.springframework.http.MediaType;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.*;\nimport org.springframework.web.multipart.MultipartFile;\nimport org.springframework.web.servlet.mvc.method.annotation.StreamingResponseBody;\n\nimport java.io.IOException;\nimport java.io.InputStream;\n\n@Slf4j\n@RestController\n@RequiredArgsConstructor\n@RequestMapping(\"/api/storage\")\npublic class StorageController {\n    // ... members ...\n}\n\n// ... code ...\n\nprivate final StorageService storageService;\n@PostMapping(value = \"/upload\", consumes = MediaType.ALL_VALUE)\n    public ResponseEntity<UploadResult> upload(@RequestParam(\"file\") MultipartFile file, @RequestParam(\"bucket\") String bucket) {\n        try {\n            log.info(\"Uploading file: {}\", file.getOriginalFilename());\n            return ResponseEntity.ok(this.storageService.upload(file.getInputStream(), file.getSize(), file.getContentType(), bucket));\n        } catch (Exception e) {\n            log.error(\"Upload failed: {}\", e.getMessage(), e);\n            throw new RuntimeException(\"Upload failed\", e);\n        }\n    }\n@GetMapping(\"/download\")\n    public ResponseEntity<StreamingResponseBody> download(@RequestParam(\"bucket\") @NotNull String bucket, @RequestParam(\"key\") @NotNull String key) {\n        log.info(\"Download requested for file ID: {}\", key);\n        return _download(this.storageService.download(bucket, key), key);\n    }\n@GetMapping(\"/download/token\")\n    public ResponseEntity<StreamingResponseBody> downloadGlb(@RequestParam(\"token\") @NotNull String token) {\n        log.info(\"Download requested for file token: {}\", token);\n        return _download(this.storageService.downloadSecure(token), token);\n    }\n@GetMapping(\"/download/ensure\")\n    public ResponseEntity<String> ensureDownload(@RequestParam(\"bucket\") @NotNull String bucket, @RequestParam(\"key\") @NotNull String key) {\n        log.info(\"Ensuring download resource for file ID: {} and driver ID: {}\", key, bucket);\n        return ResponseEntity.ok(this.storageService.generatePresignedUrl(bucket, key));\n    }\n@DeleteMapping\n    public void delete(@RequestParam(\"bucket\") @NotNull String bucket, @RequestParam(\"key\") @NotNull String key) {\n        log.info(\"Delete requested for file ID: {}\", key);\n        this.storageService.delete(bucket, key);\n    }\nprivate ResponseEntity<StreamingResponseBody> _download(InputStream inputStream, String id) {\n        StreamingResponseBody responseBody = outputStream -> {\n            try (inputStream) {\n                byte[] buffer = new byte[4096];\n                int bytesRead;\n                while ((bytesRead = inputStream.read(buffer)) != -1) {\n                    outputStream.write(buffer, 0, bytesRead);\n                }\n                outputStream.flush();\n            } catch (IOException e) {\n                log.error(\"Error streaming file with ID: {}\", id);\n                throw new RuntimeException(\"Error streaming file\", e);\n            }\n        };\n        return ResponseEntity.ok()\n                .header(HttpHeaders.CONTENT_DISPOSITION, \"attachment; filename=\\\"\" + id + \"\\\"\")\n                .contentType(MediaType.APPLICATION_OCTET_STREAM)\n                .body(responseBody);\n    }", "metadata": {"source_id": "src/main/java/it/aredegalli/media/controller/StorageController.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.controller;", "block_count": 7, "blocks_meta": [{"kind": "symbol_child", "node_type": "field_declaration", "symbol": "storageService", "qualified_name": "StorageController.storageService", "symbol_class": "unknown", "lang": "java", "line_start": 24, "line_end": 24, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/controller/StorageController.java:java:field_declaration:StorageController.storageService:24-24", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Slf4j\n@RestController\n@RequiredArgsConstructor\n@RequestMapping(\"/api/storage\")\npublic class StorageController {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.controller;\n\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.StorageService;\nimport jakarta.validation.constraints.NotNull;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.http.HttpHeaders;\nimport org.springframework.http.MediaType;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.*;\nimport org.springframework.web.multipart.MultipartFile;\nimport org.springframework.web.servlet.mvc.method.annotation.StreamingResponseBody;\n\nimport java.io.IOException;\nimport java.io.InputStream;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "upload", "qualified_name": "StorageController.upload", "symbol_class": "method", "lang": "java", "line_start": 26, "line_end": 35, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/controller/StorageController.java:java:method_declaration:StorageController.upload:26-35", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Slf4j\n@RestController\n@RequiredArgsConstructor\n@RequestMapping(\"/api/storage\")\npublic class StorageController {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.controller;\n\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.StorageService;\nimport jakarta.validation.constraints.NotNull;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.http.HttpHeaders;\nimport org.springframework.http.MediaType;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.*;\nimport org.springframework.web.multipart.MultipartFile;\nimport org.springframework.web.servlet.mvc.method.annotation.StreamingResponseBody;\n\nimport java.io.IOException;\nimport java.io.InputStream;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "download", "qualified_name": "StorageController.download", "symbol_class": "method", "lang": "java", "line_start": 37, "line_end": 41, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/controller/StorageController.java:java:method_declaration:StorageController.download:37-41", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Slf4j\n@RestController\n@RequiredArgsConstructor\n@RequestMapping(\"/api/storage\")\npublic class StorageController {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.controller;\n\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.StorageService;\nimport jakarta.validation.constraints.NotNull;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.http.HttpHeaders;\nimport org.springframework.http.MediaType;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.*;\nimport org.springframework.web.multipart.MultipartFile;\nimport org.springframework.web.servlet.mvc.method.annotation.StreamingResponseBody;\n\nimport java.io.IOException;\nimport java.io.InputStream;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "downloadGlb", "qualified_name": "StorageController.downloadGlb", "symbol_class": "method", "lang": "java", "line_start": 43, "line_end": 47, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/controller/StorageController.java:java:method_declaration:StorageController.downloadGlb:43-47", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Slf4j\n@RestController\n@RequiredArgsConstructor\n@RequestMapping(\"/api/storage\")\npublic class StorageController {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.controller;\n\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.StorageService;\nimport jakarta.validation.constraints.NotNull;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.http.HttpHeaders;\nimport org.springframework.http.MediaType;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.*;\nimport org.springframework.web.multipart.MultipartFile;\nimport org.springframework.web.servlet.mvc.method.annotation.StreamingResponseBody;\n\nimport java.io.IOException;\nimport java.io.InputStream;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "ensureDownload", "qualified_name": "StorageController.ensureDownload", "symbol_class": "method", "lang": "java", "line_start": 49, "line_end": 53, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/controller/StorageController.java:java:method_declaration:StorageController.ensureDownload:49-53", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Slf4j\n@RestController\n@RequiredArgsConstructor\n@RequestMapping(\"/api/storage\")\npublic class StorageController {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.controller;\n\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.StorageService;\nimport jakarta.validation.constraints.NotNull;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.http.HttpHeaders;\nimport org.springframework.http.MediaType;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.*;\nimport org.springframework.web.multipart.MultipartFile;\nimport org.springframework.web.servlet.mvc.method.annotation.StreamingResponseBody;\n\nimport java.io.IOException;\nimport java.io.InputStream;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "delete", "qualified_name": "StorageController.delete", "symbol_class": "method", "lang": "java", "line_start": 55, "line_end": 59, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/controller/StorageController.java:java:method_declaration:StorageController.delete:55-59", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Slf4j\n@RestController\n@RequiredArgsConstructor\n@RequestMapping(\"/api/storage\")\npublic class StorageController {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.controller;\n\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.StorageService;\nimport jakarta.validation.constraints.NotNull;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.http.HttpHeaders;\nimport org.springframework.http.MediaType;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.*;\nimport org.springframework.web.multipart.MultipartFile;\nimport org.springframework.web.servlet.mvc.method.annotation.StreamingResponseBody;\n\nimport java.io.IOException;\nimport java.io.InputStream;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "_download", "qualified_name": "StorageController._download", "symbol_class": "method", "lang": "java", "line_start": 61, "line_end": 80, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/controller/StorageController.java:java:method_declaration:StorageController._download:61-80", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Slf4j\n@RestController\n@RequiredArgsConstructor\n@RequestMapping(\"/api/storage\")\npublic class StorageController {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.controller;\n\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.StorageService;\nimport jakarta.validation.constraints.NotNull;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.http.HttpHeaders;\nimport org.springframework.http.MediaType;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.*;\nimport org.springframework.web.multipart.MultipartFile;\nimport org.springframework.web.servlet.mvc.method.annotation.StreamingResponseBody;\n\nimport java.io.IOException;\nimport java.io.InputStream;"}], "path": "src/main/java/it/aredegalli/media/controller/StorageController.java"}}
{"id": "src/main/java/it/aredegalli/media/dto/SecuredResourceResponseDto.java:java:0", "text": "package it.aredegalli.media.dto;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Builder;\nimport lombok.Data;", "metadata": {"source_id": "src/main/java/it/aredegalli/media/dto/SecuredResourceResponseDto.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.dto;", "preamble": true, "block_count": 1, "blocks_meta": [{"kind": "preamble", "lang": "java", "level": "parent", "package": "package it.aredegalli.media.dto;", "import_count": 3}], "path": "src/main/java/it/aredegalli/media/dto/SecuredResourceResponseDto.java"}}
{"id": "src/main/java/it/aredegalli/media/dto/SecuredResourceResponseDto.java:java:0", "text": "package it.aredegalli.media.dto;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Builder;\nimport lombok.Data;\n\n@Data\n@Builder\n@AllArgsConstructor\npublic class SecuredResourceResponseDto {\n    // ... members ...\n}\n\n// ... code ...\n\nprivate String key;\nprivate String bucket;", "metadata": {"source_id": "src/main/java/it/aredegalli/media/dto/SecuredResourceResponseDto.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.dto;", "block_count": 2, "blocks_meta": [{"kind": "symbol_child", "node_type": "field_declaration", "symbol": "key", "qualified_name": "SecuredResourceResponseDto.key", "symbol_class": "unknown", "lang": "java", "line_start": 12, "line_end": 12, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/dto/SecuredResourceResponseDto.java:java:field_declaration:SecuredResourceResponseDto.key:12-12", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Data\n@Builder\n@AllArgsConstructor\npublic class SecuredResourceResponseDto {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.dto;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Builder;\nimport lombok.Data;"}, {"kind": "symbol_child", "node_type": "field_declaration", "symbol": "bucket", "qualified_name": "SecuredResourceResponseDto.bucket", "symbol_class": "unknown", "lang": "java", "line_start": 13, "line_end": 13, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/dto/SecuredResourceResponseDto.java:java:field_declaration:SecuredResourceResponseDto.bucket:13-13", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Data\n@Builder\n@AllArgsConstructor\npublic class SecuredResourceResponseDto {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.dto;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Builder;\nimport lombok.Data;"}], "path": "src/main/java/it/aredegalli/media/dto/SecuredResourceResponseDto.java"}}
{"id": "src/main/java/it/aredegalli/media/dto/UploadResult.java:java:0", "text": "package it.aredegalli.media.dto;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;", "metadata": {"source_id": "src/main/java/it/aredegalli/media/dto/UploadResult.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.dto;", "preamble": true, "block_count": 1, "blocks_meta": [{"kind": "preamble", "lang": "java", "level": "parent", "package": "package it.aredegalli.media.dto;", "import_count": 2}], "path": "src/main/java/it/aredegalli/media/dto/UploadResult.java"}}
{"id": "src/main/java/it/aredegalli/media/dto/UploadResult.java:java:0", "text": "package it.aredegalli.media.dto;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\n\n@Data\n@AllArgsConstructor\npublic class UploadResult {\n    // ... members ...\n}\n\n// ... code ...\n\nprivate final String objectKey;\nprivate final byte[] hashBytes;", "metadata": {"source_id": "src/main/java/it/aredegalli/media/dto/UploadResult.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.dto;", "block_count": 2, "blocks_meta": [{"kind": "symbol_child", "node_type": "field_declaration", "symbol": "objectKey", "qualified_name": "UploadResult.objectKey", "symbol_class": "unknown", "lang": "java", "line_start": 9, "line_end": 9, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/dto/UploadResult.java:java:field_declaration:UploadResult.objectKey:9-9", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Data\n@AllArgsConstructor\npublic class UploadResult {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.dto;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;"}, {"kind": "symbol_child", "node_type": "field_declaration", "symbol": "hashBytes", "qualified_name": "UploadResult.hashBytes", "symbol_class": "unknown", "lang": "java", "line_start": 10, "line_end": 10, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/dto/UploadResult.java:java:field_declaration:UploadResult.hashBytes:10-10", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Data\n@AllArgsConstructor\npublic class UploadResult {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.dto;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;"}], "path": "src/main/java/it/aredegalli/media/dto/UploadResult.java"}}
{"id": "src/main/java/it/aredegalli/media/security/SecurityConfig.java:java:0", "text": "package it.aredegalli.media.security;\n\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;\nimport org.springframework.security.config.annotation.web.configurers.HeadersConfigurer;\nimport org.springframework.security.config.http.SessionCreationPolicy;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.web.cors.CorsConfiguration;\nimport org.springframework.web.cors.CorsConfigurationSource;\nimport org.springframework.web.cors.UrlBasedCorsConfigurationSource;\n\nimport java.util.Arrays;", "metadata": {"source_id": "src/main/java/it/aredegalli/media/security/SecurityConfig.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.security;", "preamble": true, "block_count": 1, "blocks_meta": [{"kind": "preamble", "lang": "java", "level": "parent", "package": "package it.aredegalli.media.security;", "import_count": 14}], "path": "src/main/java/it/aredegalli/media/security/SecurityConfig.java"}}
{"id": "src/main/java/it/aredegalli/media/security/SecurityConfig.java:java:0", "text": "package it.aredegalli.media.security;\n\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;\nimport org.springframework.security.config.annotation.web.configurers.HeadersConfigurer;\nimport org.springframework.security.config.http.SessionCreationPolicy;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.web.cors.CorsConfiguration;\nimport org.springframework.web.cors.CorsConfigurationSource;\nimport org.springframework.web.cors.UrlBasedCorsConfigurationSource;\n\nimport java.util.Arrays;\n\n@Configuration\n@EnableWebSecurity\n@RequiredArgsConstructor\npublic class SecurityConfig {\n    // ... members ...\n}\n\n// ... code ...\n\n@Value(\"${security.cors.allowed-origins:*}\")\n    private String allowedOrigins;\n@Value(\"${security.cors.allowed-methods:*}\")\n    private String allowedMethods;\n@Value(\"${security.cors.allowed-headers:*}\")\n    private String allowedHeaders;\n@Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        http\n                .csrf(AbstractHttpConfigurer::disable)\n                .cors(cors -> cors.configurationSource(corsConfigurationSource()))\n                .authorizeHttpRequests(auth -> auth\n                        .requestMatchers(\"/swagger-ui/**\", \"/v3/api-docs/**\").permitAll()\n                        .requestMatchers(\"/api/**\").permitAll()\n                        .requestMatchers(\"/actuator/**\").permitAll()\n                        .anyRequest().denyAll()\n                )\n                .sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))\n                .headers(headers -> headers\n                        .httpStrictTransportSecurity(hsts -> hsts.includeSubDomains(true).maxAgeInSeconds(31536000))\n                        .contentSecurityPolicy(csp -> csp.policyDirectives(\"default-src 'self'\"))\n                        .frameOptions(HeadersConfigurer.FrameOptionsConfig::sameOrigin)\n                );\n        return http.build();\n    }\n@Bean\n    public CorsConfigurationSource corsConfigurationSource() {\n        CorsConfiguration config = new CorsConfiguration();\n        config.setAllowedOriginPatterns(Arrays.asList(allowedOrigins.split(\",\")));\n        config.setAllowedMethods(Arrays.asList(allowedMethods.split(\",\")));\n        config.setAllowedHeaders(Arrays.asList(allowedHeaders.split(\",\")));\n        config.setAllowCredentials(true);\n        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();\n        source.registerCorsConfiguration(\"/**\", config);\n        return source;\n    }", "metadata": {"source_id": "src/main/java/it/aredegalli/media/security/SecurityConfig.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.security;", "block_count": 5, "blocks_meta": [{"kind": "symbol_child", "node_type": "field_declaration", "symbol": "allowedOrigins", "qualified_name": "SecurityConfig.allowedOrigins", "symbol_class": "unknown", "lang": "java", "line_start": 24, "line_end": 25, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/security/SecurityConfig.java:java:field_declaration:SecurityConfig.allowedOrigins:24-25", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Configuration\n@EnableWebSecurity\n@RequiredArgsConstructor\npublic class SecurityConfig {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.security;\n\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;\nimport org.springframework.security.config.annotation.web.configurers.HeadersConfigurer;\nimport org.springframework.security.config.http.SessionCreationPolicy;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.web.cors.CorsConfiguration;\nimport org.springframework.web.cors.CorsConfigurationSource;\nimport org.springframework.web.cors.UrlBasedCorsConfigurationSource;\n\nimport java.util.Arrays;"}, {"kind": "symbol_child", "node_type": "field_declaration", "symbol": "allowedMethods", "qualified_name": "SecurityConfig.allowedMethods", "symbol_class": "unknown", "lang": "java", "line_start": 27, "line_end": 28, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/security/SecurityConfig.java:java:field_declaration:SecurityConfig.allowedMethods:27-28", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Configuration\n@EnableWebSecurity\n@RequiredArgsConstructor\npublic class SecurityConfig {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.security;\n\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;\nimport org.springframework.security.config.annotation.web.configurers.HeadersConfigurer;\nimport org.springframework.security.config.http.SessionCreationPolicy;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.web.cors.CorsConfiguration;\nimport org.springframework.web.cors.CorsConfigurationSource;\nimport org.springframework.web.cors.UrlBasedCorsConfigurationSource;\n\nimport java.util.Arrays;"}, {"kind": "symbol_child", "node_type": "field_declaration", "symbol": "allowedHeaders", "qualified_name": "SecurityConfig.allowedHeaders", "symbol_class": "unknown", "lang": "java", "line_start": 30, "line_end": 31, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/security/SecurityConfig.java:java:field_declaration:SecurityConfig.allowedHeaders:30-31", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Configuration\n@EnableWebSecurity\n@RequiredArgsConstructor\npublic class SecurityConfig {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.security;\n\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;\nimport org.springframework.security.config.annotation.web.configurers.HeadersConfigurer;\nimport org.springframework.security.config.http.SessionCreationPolicy;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.web.cors.CorsConfiguration;\nimport org.springframework.web.cors.CorsConfigurationSource;\nimport org.springframework.web.cors.UrlBasedCorsConfigurationSource;\n\nimport java.util.Arrays;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "filterChain", "qualified_name": "SecurityConfig.filterChain", "symbol_class": "method", "lang": "java", "line_start": 33, "line_end": 52, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/security/SecurityConfig.java:java:method_declaration:SecurityConfig.filterChain:33-52", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Configuration\n@EnableWebSecurity\n@RequiredArgsConstructor\npublic class SecurityConfig {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.security;\n\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;\nimport org.springframework.security.config.annotation.web.configurers.HeadersConfigurer;\nimport org.springframework.security.config.http.SessionCreationPolicy;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.web.cors.CorsConfiguration;\nimport org.springframework.web.cors.CorsConfigurationSource;\nimport org.springframework.web.cors.UrlBasedCorsConfigurationSource;\n\nimport java.util.Arrays;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "corsConfigurationSource", "qualified_name": "SecurityConfig.corsConfigurationSource", "symbol_class": "method", "lang": "java", "line_start": 54, "line_end": 65, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/security/SecurityConfig.java:java:method_declaration:SecurityConfig.corsConfigurationSource:54-65", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Configuration\n@EnableWebSecurity\n@RequiredArgsConstructor\npublic class SecurityConfig {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.security;\n\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;\nimport org.springframework.security.config.annotation.web.configurers.HeadersConfigurer;\nimport org.springframework.security.config.http.SessionCreationPolicy;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.web.cors.CorsConfiguration;\nimport org.springframework.web.cors.CorsConfigurationSource;\nimport org.springframework.web.cors.UrlBasedCorsConfigurationSource;\n\nimport java.util.Arrays;"}], "path": "src/main/java/it/aredegalli/media/security/SecurityConfig.java"}}
{"id": "src/main/java/it/aredegalli/media/service/StorageService.java:java:0", "text": "package it.aredegalli.media.service;\n\nimport it.aredegalli.media.dto.UploadResult;\n\nimport java.io.IOException;\nimport java.io.InputStream;", "metadata": {"source_id": "src/main/java/it/aredegalli/media/service/StorageService.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.service;", "preamble": true, "block_count": 1, "blocks_meta": [{"kind": "preamble", "lang": "java", "level": "parent", "package": "package it.aredegalli.media.service;", "import_count": 3}], "path": "src/main/java/it/aredegalli/media/service/StorageService.java"}}
{"id": "src/main/java/it/aredegalli/media/service/StorageService.java:java:0", "text": "package it.aredegalli.media.service;\n\nimport it.aredegalli.media.dto.UploadResult;\n\nimport java.io.IOException;\nimport java.io.InputStream;\n\npublic interface StorageService {\n    // ... members ...\n}\n\n// ... code ...\n\n/**\n     * Carica lo stream sul bucket, calcola l’hash, e restituisce la chiave e l’hash.\n     */\nUploadResult upload(InputStream data,\n                        long size,\n                        String contentType,\n                        String bucket) throws IOException;\n/**\n     * Ritorna uno InputStream dei dati salvati con quella chiave.\n     */\nInputStream download(String bucket, String objectKey);\nvoid delete(String bucket, String objectKey);\nString generatePresignedUrl(String bucket, String objectKey);\nInputStream downloadSecure(String token);", "metadata": {"source_id": "src/main/java/it/aredegalli/media/service/StorageService.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.service;", "block_count": 5, "blocks_meta": [{"kind": "symbol_child", "node_type": "method_declaration", "symbol": "upload", "qualified_name": "StorageService.upload", "symbol_class": "method", "lang": "java", "line_start": 12, "line_end": 15, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/StorageService.java:java:method_declaration:StorageService.upload:12-15", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "public interface StorageService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service;\n\nimport it.aredegalli.media.dto.UploadResult;\n\nimport java.io.IOException;\nimport java.io.InputStream;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "download", "qualified_name": "StorageService.download", "symbol_class": "method", "lang": "java", "line_start": 20, "line_end": 20, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/StorageService.java:java:method_declaration:StorageService.download:20-20", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "public interface StorageService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service;\n\nimport it.aredegalli.media.dto.UploadResult;\n\nimport java.io.IOException;\nimport java.io.InputStream;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "delete", "qualified_name": "StorageService.delete", "symbol_class": "method", "lang": "java", "line_start": 22, "line_end": 22, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/StorageService.java:java:method_declaration:StorageService.delete:22-22", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "public interface StorageService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service;\n\nimport it.aredegalli.media.dto.UploadResult;\n\nimport java.io.IOException;\nimport java.io.InputStream;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "generatePresignedUrl", "qualified_name": "StorageService.generatePresignedUrl", "symbol_class": "method", "lang": "java", "line_start": 24, "line_end": 24, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/StorageService.java:java:method_declaration:StorageService.generatePresignedUrl:24-24", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "public interface StorageService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service;\n\nimport it.aredegalli.media.dto.UploadResult;\n\nimport java.io.IOException;\nimport java.io.InputStream;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "downloadSecure", "qualified_name": "StorageService.downloadSecure", "symbol_class": "method", "lang": "java", "line_start": 26, "line_end": 26, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/StorageService.java:java:method_declaration:StorageService.downloadSecure:26-26", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "public interface StorageService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service;\n\nimport it.aredegalli.media.dto.UploadResult;\n\nimport java.io.IOException;\nimport java.io.InputStream;"}], "path": "src/main/java/it/aredegalli/media/service/StorageService.java"}}
{"id": "src/main/java/it/aredegalli/media/service/StorageServiceImpl.java:java:0", "text": "package it.aredegalli.media.service;\n\nimport it.aredegalli.media.config.s3.S3BucketInitializer;\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.component.ResourceSecureDownloadService;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.stereotype.Service;\nimport software.amazon.awssdk.core.sync.RequestBody;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.model.CopyObjectRequest;\nimport software.amazon.awssdk.services.s3.model.DeleteObjectRequest;\nimport software.amazon.awssdk.services.s3.model.GetObjectRequest;\nimport software.amazon.awssdk.services.s3.model.PutObjectRequest;\n\nimport java.io.InputStream;\nimport java.io.PipedInputStream;\nimport java.io.PipedOutputStream;\nimport java.security.DigestInputStream;\nimport java.security.MessageDigest;\nimport java.util.UUID;", "metadata": {"source_id": "src/main/java/it/aredegalli/media/service/StorageServiceImpl.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.service;", "preamble": true, "block_count": 1, "blocks_meta": [{"kind": "preamble", "lang": "java", "level": "parent", "package": "package it.aredegalli.media.service;", "import_count": 17}], "path": "src/main/java/it/aredegalli/media/service/StorageServiceImpl.java"}}
{"id": "src/main/java/it/aredegalli/media/service/StorageServiceImpl.java:java:0", "text": "package it.aredegalli.media.service;\n\nimport it.aredegalli.media.config.s3.S3BucketInitializer;\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.component.ResourceSecureDownloadService;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.stereotype.Service;\nimport software.amazon.awssdk.core.sync.RequestBody;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.model.CopyObjectRequest;\nimport software.amazon.awssdk.services.s3.model.DeleteObjectRequest;\nimport software.amazon.awssdk.services.s3.model.GetObjectRequest;\nimport software.amazon.awssdk.services.s3.model.PutObjectRequest;\n\nimport java.io.InputStream;\nimport java.io.PipedInputStream;\nimport java.io.PipedOutputStream;\nimport java.security.DigestInputStream;\nimport java.security.MessageDigest;\nimport java.util.UUID;\n\n/**\n * Servizio che gestisce l'upload e il download su storage S3/MinIO,\n * calcolando l'hash SHA-256 on-the-fly e usando chiavi basate su hash.\n */\n@Service\n@RequiredArgsConstructor\npublic class StorageServiceImpl implements StorageService {\n    // ... members ...\n}\n\n// ... code ...\n\nprivate final S3Client s3Client;\nprivate final ResourceSecureDownloadService resourceSecureDownloadService;\nprivate final S3BucketInitializer s3BucketInitializer;\n@Override\n    public UploadResult upload(InputStream data,\n                               long size,\n                               String contentType,\n                               String bucket) {\n        byte[] hashBytes;\n        String hashHex;\n        String tempKey = UUID.randomUUID().toString();\n        try {\n            MessageDigest md = MessageDigest.getInstance(\"SHA-256\");\n            DigestInputStream dis = new DigestInputStream(data, md);\n            PipedOutputStream pos = new PipedOutputStream();\n            PipedInputStream pis = new PipedInputStream(pos, 8 * 1024);\n            Thread pump = getDigestThread(dis, pos);\n            this.s3BucketInitializer.createBucketIfNotExists(bucket);\n            PutObjectRequest tempPut = PutObjectRequest.builder()\n                    .bucket(bucket)\n                    .key(tempKey)\n                    .contentType(contentType)\n                    .contentLength(size)\n                    .build();\n            s3Client.putObject(tempPut, RequestBody.fromInputStream(pis, size));\n            pump.join();\n            hashBytes = md.digest();\n            StringBuilder sb = new StringBuilder(2 * hashBytes.length);\n            for (byte b : hashBytes) sb.append(String.format(\"%02x\", b));\n            hashHex = sb.toString();\n            CopyObjectRequest copyReq = CopyObjectRequest.builder()\n                    .copySource(bucket + \"/\" + tempKey)\n                    .destinationBucket(bucket)\n                    .destinationKey(hashHex)\n                    .build();\n            s3Client.copyObject(copyReq);\n            DeleteObjectRequest delReq = DeleteObjectRequest.builder()\n                    .bucket(bucket)\n                    .key(tempKey)\n                    .build();\n            s3Client.deleteObject(delReq);\n        } catch (Exception e) {\n            throw new RuntimeException(\"Errore durante l'upload dello stream\", e);\n        }\n        return new UploadResult(hashHex, hashBytes);\n    }\n@Override\n    public InputStream download(String bucket, String objectKey) {\n        GetObjectRequest getReq = GetObjectRequest.builder()\n                .bucket(bucket)\n                .key(objectKey)\n                .build();\n        return s3Client.getObject(getReq);\n    }\n@Override\n    public void delete(String bucket, String objectKey) {\n        DeleteObjectRequest delReq = DeleteObjectRequest.builder()\n                .bucket(bucket)\n                .key(objectKey)\n                .build();\n        s3Client.deleteObject(delReq);\n    }\n@Override\n    public String generatePresignedUrl(String bucket, String objectKey) {\n        return this.resourceSecureDownloadService.generateSecureDownloadToken(objectKey, bucket);\n    }\n@Override\n    public InputStream downloadSecure(String token) {\n        var info = this.resourceSecureDownloadService.validateTokenAndExtractResourceId(token);\n        return this.download(info.getBucket(), info.getKey());\n    }\nprivate static Thread getDigestThread(DigestInputStream dis, PipedOutputStream pos) {\n        Thread pump = new Thread(() -> {\n            byte[] buffer = new byte[4 * 1024];\n            int read;\n            try {\n                while ((read = dis.read(buffer)) != -1) {\n                    pos.write(buffer, 0, read);\n                }\n            } catch (Exception ignored) {\n            } finally {\n                try {\n                    pos.close();\n                } catch (Exception ignored) {\n                }\n                try {\n                    dis.close();\n                } catch (Exception ignored) {\n                }\n            }\n        }, \"s3-hash-pump\");\n        pump.start();\n        return pump;\n    }", "metadata": {"source_id": "src/main/java/it/aredegalli/media/service/StorageServiceImpl.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.service;", "block_count": 9, "blocks_meta": [{"kind": "symbol_child", "node_type": "field_declaration", "symbol": "s3Client", "qualified_name": "StorageServiceImpl.s3Client", "symbol_class": "unknown", "lang": "java", "line_start": 30, "line_end": 30, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/StorageServiceImpl.java:java:field_declaration:StorageServiceImpl.s3Client:30-30", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "/**\n * Servizio che gestisce l'upload e il download su storage S3/MinIO,\n * calcolando l'hash SHA-256 on-the-fly e usando chiavi basate su hash.\n */\n@Service\n@RequiredArgsConstructor\npublic class StorageServiceImpl implements StorageService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service;\n\nimport it.aredegalli.media.config.s3.S3BucketInitializer;\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.component.ResourceSecureDownloadService;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.stereotype.Service;\nimport software.amazon.awssdk.core.sync.RequestBody;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.model.CopyObjectRequest;\nimport software.amazon.awssdk.services.s3.model.DeleteObjectRequest;\nimport software.amazon.awssdk.services.s3.model.GetObjectRequest;\nimport software.amazon.awssdk.services.s3.model.PutObjectRequest;\n\nimport java.io.InputStream;\nimport java.io.PipedInputStream;\nimport java.io.PipedOutputStream;\nimport java.security.DigestInputStream;\nimport java.security.MessageDigest;\nimport java.util.UUID;"}, {"kind": "symbol_child", "node_type": "field_declaration", "symbol": "resourceSecureDownloadService", "qualified_name": "StorageServiceImpl.resourceSecureDownloadService", "symbol_class": "unknown", "lang": "java", "line_start": 31, "line_end": 31, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/StorageServiceImpl.java:java:field_declaration:StorageServiceImpl.resourceSecureDownloadService:31-31", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "/**\n * Servizio che gestisce l'upload e il download su storage S3/MinIO,\n * calcolando l'hash SHA-256 on-the-fly e usando chiavi basate su hash.\n */\n@Service\n@RequiredArgsConstructor\npublic class StorageServiceImpl implements StorageService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service;\n\nimport it.aredegalli.media.config.s3.S3BucketInitializer;\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.component.ResourceSecureDownloadService;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.stereotype.Service;\nimport software.amazon.awssdk.core.sync.RequestBody;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.model.CopyObjectRequest;\nimport software.amazon.awssdk.services.s3.model.DeleteObjectRequest;\nimport software.amazon.awssdk.services.s3.model.GetObjectRequest;\nimport software.amazon.awssdk.services.s3.model.PutObjectRequest;\n\nimport java.io.InputStream;\nimport java.io.PipedInputStream;\nimport java.io.PipedOutputStream;\nimport java.security.DigestInputStream;\nimport java.security.MessageDigest;\nimport java.util.UUID;"}, {"kind": "symbol_child", "node_type": "field_declaration", "symbol": "s3BucketInitializer", "qualified_name": "StorageServiceImpl.s3BucketInitializer", "symbol_class": "unknown", "lang": "java", "line_start": 32, "line_end": 32, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/StorageServiceImpl.java:java:field_declaration:StorageServiceImpl.s3BucketInitializer:32-32", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "/**\n * Servizio che gestisce l'upload e il download su storage S3/MinIO,\n * calcolando l'hash SHA-256 on-the-fly e usando chiavi basate su hash.\n */\n@Service\n@RequiredArgsConstructor\npublic class StorageServiceImpl implements StorageService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service;\n\nimport it.aredegalli.media.config.s3.S3BucketInitializer;\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.component.ResourceSecureDownloadService;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.stereotype.Service;\nimport software.amazon.awssdk.core.sync.RequestBody;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.model.CopyObjectRequest;\nimport software.amazon.awssdk.services.s3.model.DeleteObjectRequest;\nimport software.amazon.awssdk.services.s3.model.GetObjectRequest;\nimport software.amazon.awssdk.services.s3.model.PutObjectRequest;\n\nimport java.io.InputStream;\nimport java.io.PipedInputStream;\nimport java.io.PipedOutputStream;\nimport java.security.DigestInputStream;\nimport java.security.MessageDigest;\nimport java.util.UUID;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "upload", "qualified_name": "StorageServiceImpl.upload", "symbol_class": "method", "lang": "java", "line_start": 34, "line_end": 85, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/StorageServiceImpl.java:java:method_declaration:StorageServiceImpl.upload:34-85", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "/**\n * Servizio che gestisce l'upload e il download su storage S3/MinIO,\n * calcolando l'hash SHA-256 on-the-fly e usando chiavi basate su hash.\n */\n@Service\n@RequiredArgsConstructor\npublic class StorageServiceImpl implements StorageService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service;\n\nimport it.aredegalli.media.config.s3.S3BucketInitializer;\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.component.ResourceSecureDownloadService;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.stereotype.Service;\nimport software.amazon.awssdk.core.sync.RequestBody;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.model.CopyObjectRequest;\nimport software.amazon.awssdk.services.s3.model.DeleteObjectRequest;\nimport software.amazon.awssdk.services.s3.model.GetObjectRequest;\nimport software.amazon.awssdk.services.s3.model.PutObjectRequest;\n\nimport java.io.InputStream;\nimport java.io.PipedInputStream;\nimport java.io.PipedOutputStream;\nimport java.security.DigestInputStream;\nimport java.security.MessageDigest;\nimport java.util.UUID;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "download", "qualified_name": "StorageServiceImpl.download", "symbol_class": "method", "lang": "java", "line_start": 87, "line_end": 94, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/StorageServiceImpl.java:java:method_declaration:StorageServiceImpl.download:87-94", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "/**\n * Servizio che gestisce l'upload e il download su storage S3/MinIO,\n * calcolando l'hash SHA-256 on-the-fly e usando chiavi basate su hash.\n */\n@Service\n@RequiredArgsConstructor\npublic class StorageServiceImpl implements StorageService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service;\n\nimport it.aredegalli.media.config.s3.S3BucketInitializer;\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.component.ResourceSecureDownloadService;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.stereotype.Service;\nimport software.amazon.awssdk.core.sync.RequestBody;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.model.CopyObjectRequest;\nimport software.amazon.awssdk.services.s3.model.DeleteObjectRequest;\nimport software.amazon.awssdk.services.s3.model.GetObjectRequest;\nimport software.amazon.awssdk.services.s3.model.PutObjectRequest;\n\nimport java.io.InputStream;\nimport java.io.PipedInputStream;\nimport java.io.PipedOutputStream;\nimport java.security.DigestInputStream;\nimport java.security.MessageDigest;\nimport java.util.UUID;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "delete", "qualified_name": "StorageServiceImpl.delete", "symbol_class": "method", "lang": "java", "line_start": 96, "line_end": 103, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/StorageServiceImpl.java:java:method_declaration:StorageServiceImpl.delete:96-103", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "/**\n * Servizio che gestisce l'upload e il download su storage S3/MinIO,\n * calcolando l'hash SHA-256 on-the-fly e usando chiavi basate su hash.\n */\n@Service\n@RequiredArgsConstructor\npublic class StorageServiceImpl implements StorageService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service;\n\nimport it.aredegalli.media.config.s3.S3BucketInitializer;\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.component.ResourceSecureDownloadService;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.stereotype.Service;\nimport software.amazon.awssdk.core.sync.RequestBody;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.model.CopyObjectRequest;\nimport software.amazon.awssdk.services.s3.model.DeleteObjectRequest;\nimport software.amazon.awssdk.services.s3.model.GetObjectRequest;\nimport software.amazon.awssdk.services.s3.model.PutObjectRequest;\n\nimport java.io.InputStream;\nimport java.io.PipedInputStream;\nimport java.io.PipedOutputStream;\nimport java.security.DigestInputStream;\nimport java.security.MessageDigest;\nimport java.util.UUID;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "generatePresignedUrl", "qualified_name": "StorageServiceImpl.generatePresignedUrl", "symbol_class": "method", "lang": "java", "line_start": 105, "line_end": 108, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/StorageServiceImpl.java:java:method_declaration:StorageServiceImpl.generatePresignedUrl:105-108", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "/**\n * Servizio che gestisce l'upload e il download su storage S3/MinIO,\n * calcolando l'hash SHA-256 on-the-fly e usando chiavi basate su hash.\n */\n@Service\n@RequiredArgsConstructor\npublic class StorageServiceImpl implements StorageService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service;\n\nimport it.aredegalli.media.config.s3.S3BucketInitializer;\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.component.ResourceSecureDownloadService;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.stereotype.Service;\nimport software.amazon.awssdk.core.sync.RequestBody;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.model.CopyObjectRequest;\nimport software.amazon.awssdk.services.s3.model.DeleteObjectRequest;\nimport software.amazon.awssdk.services.s3.model.GetObjectRequest;\nimport software.amazon.awssdk.services.s3.model.PutObjectRequest;\n\nimport java.io.InputStream;\nimport java.io.PipedInputStream;\nimport java.io.PipedOutputStream;\nimport java.security.DigestInputStream;\nimport java.security.MessageDigest;\nimport java.util.UUID;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "downloadSecure", "qualified_name": "StorageServiceImpl.downloadSecure", "symbol_class": "method", "lang": "java", "line_start": 110, "line_end": 114, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/StorageServiceImpl.java:java:method_declaration:StorageServiceImpl.downloadSecure:110-114", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "/**\n * Servizio che gestisce l'upload e il download su storage S3/MinIO,\n * calcolando l'hash SHA-256 on-the-fly e usando chiavi basate su hash.\n */\n@Service\n@RequiredArgsConstructor\npublic class StorageServiceImpl implements StorageService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service;\n\nimport it.aredegalli.media.config.s3.S3BucketInitializer;\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.component.ResourceSecureDownloadService;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.stereotype.Service;\nimport software.amazon.awssdk.core.sync.RequestBody;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.model.CopyObjectRequest;\nimport software.amazon.awssdk.services.s3.model.DeleteObjectRequest;\nimport software.amazon.awssdk.services.s3.model.GetObjectRequest;\nimport software.amazon.awssdk.services.s3.model.PutObjectRequest;\n\nimport java.io.InputStream;\nimport java.io.PipedInputStream;\nimport java.io.PipedOutputStream;\nimport java.security.DigestInputStream;\nimport java.security.MessageDigest;\nimport java.util.UUID;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "getDigestThread", "qualified_name": "StorageServiceImpl.getDigestThread", "symbol_class": "method", "lang": "java", "line_start": 116, "line_end": 138, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/StorageServiceImpl.java:java:method_declaration:StorageServiceImpl.getDigestThread:116-138", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "/**\n * Servizio che gestisce l'upload e il download su storage S3/MinIO,\n * calcolando l'hash SHA-256 on-the-fly e usando chiavi basate su hash.\n */\n@Service\n@RequiredArgsConstructor\npublic class StorageServiceImpl implements StorageService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service;\n\nimport it.aredegalli.media.config.s3.S3BucketInitializer;\nimport it.aredegalli.media.dto.UploadResult;\nimport it.aredegalli.media.service.component.ResourceSecureDownloadService;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.stereotype.Service;\nimport software.amazon.awssdk.core.sync.RequestBody;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.model.CopyObjectRequest;\nimport software.amazon.awssdk.services.s3.model.DeleteObjectRequest;\nimport software.amazon.awssdk.services.s3.model.GetObjectRequest;\nimport software.amazon.awssdk.services.s3.model.PutObjectRequest;\n\nimport java.io.InputStream;\nimport java.io.PipedInputStream;\nimport java.io.PipedOutputStream;\nimport java.security.DigestInputStream;\nimport java.security.MessageDigest;\nimport java.util.UUID;"}], "path": "src/main/java/it/aredegalli/media/service/StorageServiceImpl.java"}}
{"id": "src/main/java/it/aredegalli/media/util/HashUtil.java:java:0", "text": "package it.aredegalli.media.util;\n\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport javax.crypto.Mac;\nimport javax.crypto.spec.SecretKeySpec;\nimport java.nio.charset.StandardCharsets;\nimport java.security.MessageDigest;\nimport java.security.NoSuchAlgorithmException;\nimport java.util.Base64;", "metadata": {"source_id": "src/main/java/it/aredegalli/media/util/HashUtil.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.util;", "preamble": true, "block_count": 1, "blocks_meta": [{"kind": "preamble", "lang": "java", "level": "parent", "package": "package it.aredegalli.media.util;", "import_count": 8}], "path": "src/main/java/it/aredegalli/media/util/HashUtil.java"}}
{"id": "src/main/java/it/aredegalli/media/util/HashUtil.java:java:0", "text": "package it.aredegalli.media.util;\n\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport javax.crypto.Mac;\nimport javax.crypto.spec.SecretKeySpec;\nimport java.nio.charset.StandardCharsets;\nimport java.security.MessageDigest;\nimport java.security.NoSuchAlgorithmException;\nimport java.util.Base64;\n\n@Component\npublic class HashUtil {\n    // ... members ...\n}\n\n// ... code ...\n\n@Value(\"${hmac.secret.key}\")\n    private String secretKey;\npublic String hmacSha256(String data) {\n        try {\n            byte[] keyBytes = Base64.getDecoder().decode(secretKey);\n            Mac mac = Mac.getInstance(\"HmacSHA256\");\n            SecretKeySpec secretKeySpec = new SecretKeySpec(keyBytes, \"HmacSHA256\");\n            mac.init(secretKeySpec);\n            byte[] hashBytes = mac.doFinal(data.getBytes(StandardCharsets.UTF_8));\n            return Base64.getEncoder().encodeToString(hashBytes);\n        } catch (Exception e) {\n            throw new RuntimeException(\"HMAC-SHA256 error\", e);\n        }\n    }\npublic String sha256(String input) {\n        try {\n            MessageDigest digest = MessageDigest.getInstance(\"SHA-256\");\n            byte[] hashBytes = digest.digest(input.getBytes(StandardCharsets.UTF_8));\n            StringBuilder hexString = new StringBuilder();\n            for (byte b : hashBytes) {\n                String hex = Integer.toHexString(0xff & b);\n                if (hex.length() == 1) hexString.append('0');\n                hexString.append(hex);\n            }\n            return hexString.toString();\n        } catch (NoSuchAlgorithmException e) {\n            throw new RuntimeException(\"SHA-256 not supported\", e);\n        }\n    }", "metadata": {"source_id": "src/main/java/it/aredegalli/media/util/HashUtil.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.util;", "block_count": 3, "blocks_meta": [{"kind": "symbol_child", "node_type": "field_declaration", "symbol": "secretKey", "qualified_name": "HashUtil.secretKey", "symbol_class": "unknown", "lang": "java", "line_start": 16, "line_end": 17, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/util/HashUtil.java:java:field_declaration:HashUtil.secretKey:16-17", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Component\npublic class HashUtil {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.util;\n\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport javax.crypto.Mac;\nimport javax.crypto.spec.SecretKeySpec;\nimport java.nio.charset.StandardCharsets;\nimport java.security.MessageDigest;\nimport java.security.NoSuchAlgorithmException;\nimport java.util.Base64;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "hmacSha256", "qualified_name": "HashUtil.hmacSha256", "symbol_class": "method", "lang": "java", "line_start": 19, "line_end": 30, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/util/HashUtil.java:java:method_declaration:HashUtil.hmacSha256:19-30", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Component\npublic class HashUtil {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.util;\n\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport javax.crypto.Mac;\nimport javax.crypto.spec.SecretKeySpec;\nimport java.nio.charset.StandardCharsets;\nimport java.security.MessageDigest;\nimport java.security.NoSuchAlgorithmException;\nimport java.util.Base64;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "sha256", "qualified_name": "HashUtil.sha256", "symbol_class": "method", "lang": "java", "line_start": 32, "line_end": 48, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/util/HashUtil.java:java:method_declaration:HashUtil.sha256:32-48", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Component\npublic class HashUtil {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.util;\n\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport javax.crypto.Mac;\nimport javax.crypto.spec.SecretKeySpec;\nimport java.nio.charset.StandardCharsets;\nimport java.security.MessageDigest;\nimport java.security.NoSuchAlgorithmException;\nimport java.util.Base64;"}], "path": "src/main/java/it/aredegalli/media/util/HashUtil.java"}}
{"id": "src/main/java/it/aredegalli/media/config/redis/RedisConfig.java:java:0", "text": "package it.aredegalli.media.config.redis;\n\nimport com.fasterxml.jackson.annotation.JsonTypeInfo;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport com.fasterxml.jackson.databind.jsontype.BasicPolymorphicTypeValidator;\nimport com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;\nimport org.springframework.cache.annotation.EnableCaching;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.cache.RedisCacheConfiguration;\nimport org.springframework.data.redis.cache.RedisCacheManager;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;\nimport org.springframework.data.redis.serializer.RedisSerializationContext;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\nimport java.time.Duration;", "metadata": {"source_id": "src/main/java/it/aredegalli/media/config/redis/RedisConfig.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.config.redis;", "preamble": true, "block_count": 1, "blocks_meta": [{"kind": "preamble", "lang": "java", "level": "parent", "package": "package it.aredegalli.media.config.redis;", "import_count": 15}], "path": "src/main/java/it/aredegalli/media/config/redis/RedisConfig.java"}}
{"id": "src/main/java/it/aredegalli/media/config/redis/RedisConfig.java:java:0", "text": "package it.aredegalli.media.config.redis;\n\nimport com.fasterxml.jackson.annotation.JsonTypeInfo;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport com.fasterxml.jackson.databind.jsontype.BasicPolymorphicTypeValidator;\nimport com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;\nimport org.springframework.cache.annotation.EnableCaching;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.cache.RedisCacheConfiguration;\nimport org.springframework.data.redis.cache.RedisCacheManager;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;\nimport org.springframework.data.redis.serializer.RedisSerializationContext;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\nimport java.time.Duration;\n\n/**\n * Configurazione completa per Redis in Spring Boot.\n * \n * Questa configurazione abilita il caching e configura Redis per serializzare\n * gli oggetti in JSON invece del formato binario di default (JDK serialization).\n * La serializzazione JSON è più leggibile, portabile e flessibile.\n */\n@Configuration\n@EnableCaching\npublic class RedisConfig {\n    // ... members ...\n}\n\n// ... code ...\n\n/**\n     * Configura il RedisTemplate per operazioni dirette su Redis.\n     *\n     * Il RedisTemplate è l'interfaccia principale per interagire con Redis.\n     * Qui lo configuriamo per usare:\n     * - StringRedisSerializer per le chiavi (più leggibile nei tool di debug)\n     * - GenericJackson2JsonRedisSerializer per i valori (supporta qualsiasi oggetto Java)\n     */\n@Bean\n    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory connectionFactory) {\n        RedisTemplate<String, Object> template = new RedisTemplate<>();\n        template.setConnectionFactory(connectionFactory);\n        // Configuriamo ObjectMapper per gestire correttamente i tipi Java\n        ObjectMapper objectMapper = new ObjectMapper();\n        objectMapper.registerModule(new JavaTimeModule()); // Supporto per LocalDate, LocalDateTime, etc.\n        // Abilita il type info per permettere la deserializzazione corretta\n        // Questo aggiunge informazioni sul tipo nell'JSON per ricostruire l'oggetto giusto\n        objectMapper.activateDefaultTyping(\n            BasicPolymorphicTypeValidator.builder()\n                .allowIfBaseType(Object.class)\n                .build(),\n            ObjectMapper.DefaultTyping.NON_FINAL,\n            JsonTypeInfo.As.PROPERTY\n        );\n        GenericJackson2JsonRedisSerializer jackson2JsonRedisSerializer =\n            new GenericJackson2JsonRedisSerializer(objectMapper);\n        // Configuriamo i serializer per chiavi e valori\n        StringRedisSerializer stringRedisSerializer = new StringRedisSerializer();\n        template.setKeySerializer(stringRedisSerializer);\n        template.setValueSerializer(jackson2JsonRedisSerializer);\n        template.setHashKeySerializer(stringRedisSerializer);\n        template.setHashValueSerializer(jackson2JsonRedisSerializer);\n        template.afterPropertiesSet();\n        return template;\n    }\n/**\n     * Configura il CacheManager per l'annotazione @Cacheable di Spring.\n     *\n     * Questo bean gestisce automaticamente il caching dichiarativo.\n     * Puoi configurare diversi TTL (Time To Live) per diverse cache.\n     */\n@Bean\n    public RedisCacheManager cacheManager(RedisConnectionFactory connectionFactory) {\n        // Configurazione di default per tutte le cache\n        RedisCacheConfiguration defaultConfig = RedisCacheConfiguration.defaultCacheConfig()\n            .entryTtl(Duration.ofMinutes(10)) // TTL di default: 10 minuti\n            .disableCachingNullValues() // Non cachare valori null\n            .serializeKeysWith(\n                RedisSerializationContext.SerializationPair.fromSerializer(new StringRedisSerializer())\n            )\n            .serializeValuesWith(\n                RedisSerializationContext.SerializationPair.fromSerializer(\n                    new GenericJackson2JsonRedisSerializer()\n                )\n            );\n        // Puoi anche configurare cache specifiche con TTL diversi\n        // Map<String, RedisCacheConfiguration> cacheConfigurations = new HashMap<>();\n        // cacheConfigurations.put(\"users\", defaultConfig.entryTtl(Duration.ofHours(1)));\n        // cacheConfigurations.put(\"products\", defaultConfig.entryTtl(Duration.ofMinutes(30)));\n        return RedisCacheManager.builder(connectionFactory)\n            .cacheDefaults(defaultConfig)\n            // .withInitialCacheConfigurations(cacheConfigurations) // Configurazioni per cache specifiche\n            .build();\n    }", "metadata": {"source_id": "src/main/java/it/aredegalli/media/config/redis/RedisConfig.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.config.redis;", "block_count": 2, "blocks_meta": [{"kind": "symbol_child", "node_type": "method_declaration", "symbol": "redisTemplate", "qualified_name": "RedisConfig.redisTemplate", "symbol_class": "method", "lang": "java", "line_start": 39, "line_end": 71, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/config/redis/RedisConfig.java:java:method_declaration:RedisConfig.redisTemplate:39-71", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Configurazione completa per Redis in Spring Boot.\n * \n * Questa configurazione abilita il caching e configura Redis per serializzare\n * gli oggetti in JSON invece del formato binario di default (JDK serialization).\n * La serializzazione JSON è più leggibile, portabile e flessibile.\n */\n@Configuration\n@EnableCaching\npublic class RedisConfig {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.config.redis;\n\nimport com.fasterxml.jackson.annotation.JsonTypeInfo;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport com.fasterxml.jackson.databind.jsontype.BasicPolymorphicTypeValidator;\nimport com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;\nimport org.springframework.cache.annotation.EnableCaching;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.cache.RedisCacheConfiguration;\nimport org.springframework.data.redis.cache.RedisCacheManager;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;\nimport org.springframework.data.redis.serializer.RedisSerializationContext;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\nimport java.time.Duration;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "cacheManager", "qualified_name": "RedisConfig.cacheManager", "symbol_class": "method", "lang": "java", "line_start": 79, "line_end": 103, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/config/redis/RedisConfig.java:java:method_declaration:RedisConfig.cacheManager:79-103", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Configurazione completa per Redis in Spring Boot.\n * \n * Questa configurazione abilita il caching e configura Redis per serializzare\n * gli oggetti in JSON invece del formato binario di default (JDK serialization).\n * La serializzazione JSON è più leggibile, portabile e flessibile.\n */\n@Configuration\n@EnableCaching\npublic class RedisConfig {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.config.redis;\n\nimport com.fasterxml.jackson.annotation.JsonTypeInfo;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport com.fasterxml.jackson.databind.jsontype.BasicPolymorphicTypeValidator;\nimport com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;\nimport org.springframework.cache.annotation.EnableCaching;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.cache.RedisCacheConfiguration;\nimport org.springframework.data.redis.cache.RedisCacheManager;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;\nimport org.springframework.data.redis.serializer.RedisSerializationContext;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\nimport java.time.Duration;"}], "path": "src/main/java/it/aredegalli/media/config/redis/RedisConfig.java"}}
{"id": "src/main/java/it/aredegalli/media/config/s3/S3BucketInitializer.java:java:0", "text": "package it.aredegalli.media.config.s3;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.boot.context.event.ApplicationReadyEvent;\nimport org.springframework.context.event.EventListener;\nimport org.springframework.stereotype.Component;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.model.CreateBucketRequest;\nimport software.amazon.awssdk.services.s3.model.HeadBucketRequest;\nimport software.amazon.awssdk.services.s3.model.NoSuchBucketException;\n\nimport java.util.List;", "metadata": {"source_id": "src/main/java/it/aredegalli/media/config/s3/S3BucketInitializer.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.config.s3;", "preamble": true, "block_count": 1, "blocks_meta": [{"kind": "preamble", "lang": "java", "level": "parent", "package": "package it.aredegalli.media.config.s3;", "import_count": 11}], "path": "src/main/java/it/aredegalli/media/config/s3/S3BucketInitializer.java"}}
{"id": "src/main/java/it/aredegalli/media/config/s3/S3BucketInitializer.java:java:0", "text": "package it.aredegalli.media.config.s3;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.boot.context.event.ApplicationReadyEvent;\nimport org.springframework.context.event.EventListener;\nimport org.springframework.stereotype.Component;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.model.CreateBucketRequest;\nimport software.amazon.awssdk.services.s3.model.HeadBucketRequest;\nimport software.amazon.awssdk.services.s3.model.NoSuchBucketException;\n\nimport java.util.List;\n\n/**\n * Inizializza i bucket S3 necessari all'avvio dell'applicazione.\n */\n@Component\n@RequiredArgsConstructor\n@Slf4j\npublic class S3BucketInitializer {\n    // ... members ...\n}\n\n// ... code ...\n\nprivate final S3Client s3Client;\npublic void createBucketIfNotExists(String bucketName) {\n        try {\n            if (bucketExists(bucketName)) {\n                log.info(\"✓ Bucket '{}' già esistente\", bucketName);\n                return;\n            }\n            CreateBucketRequest request = CreateBucketRequest.builder()\n                .bucket(bucketName)\n                .build();\n            s3Client.createBucket(request);\n            log.info(\"✓ Bucket '{}' creato con successo\", bucketName);\n        } catch (Exception e) {\n            log.error(\"✗ Errore creazione bucket '{}': {}\", bucketName, e.getMessage());\n        }\n    }\npublic boolean bucketExists(String bucketName) {\n        try {\n            s3Client.headBucket(HeadBucketRequest.builder().bucket(bucketName).build());\n            return true;\n        } catch (NoSuchBucketException e) {\n            return false;\n        }\n    }", "metadata": {"source_id": "src/main/java/it/aredegalli/media/config/s3/S3BucketInitializer.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.config.s3;", "block_count": 3, "blocks_meta": [{"kind": "symbol_child", "node_type": "field_declaration", "symbol": "s3Client", "qualified_name": "S3BucketInitializer.s3Client", "symbol_class": "unknown", "lang": "java", "line_start": 24, "line_end": 24, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/config/s3/S3BucketInitializer.java:java:field_declaration:S3BucketInitializer.s3Client:24-24", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "/**\n * Inizializza i bucket S3 necessari all'avvio dell'applicazione.\n */\n@Component\n@RequiredArgsConstructor\n@Slf4j\npublic class S3BucketInitializer {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.config.s3;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.boot.context.event.ApplicationReadyEvent;\nimport org.springframework.context.event.EventListener;\nimport org.springframework.stereotype.Component;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.model.CreateBucketRequest;\nimport software.amazon.awssdk.services.s3.model.HeadBucketRequest;\nimport software.amazon.awssdk.services.s3.model.NoSuchBucketException;\n\nimport java.util.List;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "createBucketIfNotExists", "qualified_name": "S3BucketInitializer.createBucketIfNotExists", "symbol_class": "method", "lang": "java", "line_start": 26, "line_end": 43, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/config/s3/S3BucketInitializer.java:java:method_declaration:S3BucketInitializer.createBucketIfNotExists:26-43", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "/**\n * Inizializza i bucket S3 necessari all'avvio dell'applicazione.\n */\n@Component\n@RequiredArgsConstructor\n@Slf4j\npublic class S3BucketInitializer {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.config.s3;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.boot.context.event.ApplicationReadyEvent;\nimport org.springframework.context.event.EventListener;\nimport org.springframework.stereotype.Component;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.model.CreateBucketRequest;\nimport software.amazon.awssdk.services.s3.model.HeadBucketRequest;\nimport software.amazon.awssdk.services.s3.model.NoSuchBucketException;\n\nimport java.util.List;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "bucketExists", "qualified_name": "S3BucketInitializer.bucketExists", "symbol_class": "method", "lang": "java", "line_start": 45, "line_end": 52, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/config/s3/S3BucketInitializer.java:java:method_declaration:S3BucketInitializer.bucketExists:45-52", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "/**\n * Inizializza i bucket S3 necessari all'avvio dell'applicazione.\n */\n@Component\n@RequiredArgsConstructor\n@Slf4j\npublic class S3BucketInitializer {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.config.s3;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.boot.context.event.ApplicationReadyEvent;\nimport org.springframework.context.event.EventListener;\nimport org.springframework.stereotype.Component;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.model.CreateBucketRequest;\nimport software.amazon.awssdk.services.s3.model.HeadBucketRequest;\nimport software.amazon.awssdk.services.s3.model.NoSuchBucketException;\n\nimport java.util.List;"}], "path": "src/main/java/it/aredegalli/media/config/s3/S3BucketInitializer.java"}}
{"id": "src/main/java/it/aredegalli/media/config/s3/S3Config.java:java:0", "text": "package it.aredegalli.media.config.s3;\n\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.boot.context.properties.EnableConfigurationProperties;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport software.amazon.awssdk.auth.credentials.AwsBasicCredentials;\nimport software.amazon.awssdk.auth.credentials.StaticCredentialsProvider;\nimport software.amazon.awssdk.core.client.config.ClientOverrideConfiguration;\nimport software.amazon.awssdk.http.SdkHttpClient;\nimport software.amazon.awssdk.http.apache.ApacheHttpClient;\nimport software.amazon.awssdk.regions.Region;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.S3Configuration;\n\nimport java.net.URI;\nimport java.time.Duration;", "metadata": {"source_id": "src/main/java/it/aredegalli/media/config/s3/S3Config.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.config.s3;", "preamble": true, "block_count": 1, "blocks_meta": [{"kind": "preamble", "lang": "java", "level": "parent", "package": "package it.aredegalli.media.config.s3;", "import_count": 14}], "path": "src/main/java/it/aredegalli/media/config/s3/S3Config.java"}}
{"id": "src/main/java/it/aredegalli/media/config/s3/S3Config.java:java:0", "text": "package it.aredegalli.media.config.s3;\n\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.boot.context.properties.EnableConfigurationProperties;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport software.amazon.awssdk.auth.credentials.AwsBasicCredentials;\nimport software.amazon.awssdk.auth.credentials.StaticCredentialsProvider;\nimport software.amazon.awssdk.core.client.config.ClientOverrideConfiguration;\nimport software.amazon.awssdk.http.SdkHttpClient;\nimport software.amazon.awssdk.http.apache.ApacheHttpClient;\nimport software.amazon.awssdk.regions.Region;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.S3Configuration;\n\nimport java.net.URI;\nimport java.time.Duration;\n\n@Configuration\n@EnableConfigurationProperties(S3Properties.class)\n@RequiredArgsConstructor\npublic class S3Config {\n    // ... members ...\n}\n\n// ... code ...\n\nprivate final S3Properties s3Properties;\n@Bean\n    public S3Client s3Client() {\n        SdkHttpClient httpClient = ApacheHttpClient.builder()\n                .connectionTimeout(Duration.ofSeconds(30))\n                .socketTimeout(Duration.ofMinutes(10))\n                .connectionAcquisitionTimeout(Duration.ofSeconds(30))\n                .maxConnections(100)\n                .build();\n        ClientOverrideConfiguration clientConfig = ClientOverrideConfiguration.builder()\n                .apiCallTimeout(Duration.ofMinutes(15))\n                .apiCallAttemptTimeout(Duration.ofMinutes(10))\n                .build();\n        return S3Client.builder()\n                .endpointOverride(URI.create(this.s3Properties.getEndpoint()))\n                .credentialsProvider(\n                        StaticCredentialsProvider.create(\n                                AwsBasicCredentials.create(this.s3Properties.getAccessKey(), this.s3Properties.getSecretKey())\n                        )\n                )\n                .region(Region.of(this.s3Properties.getRegion()))\n                .httpClient(httpClient)\n                .overrideConfiguration(clientConfig)\n                .serviceConfiguration(\n                        S3Configuration.builder()\n                                .pathStyleAccessEnabled(true)\n                                .chunkedEncodingEnabled(true)\n                                .build()\n                )\n                .build();\n    }", "metadata": {"source_id": "src/main/java/it/aredegalli/media/config/s3/S3Config.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.config.s3;", "block_count": 2, "blocks_meta": [{"kind": "symbol_child", "node_type": "field_declaration", "symbol": "s3Properties", "qualified_name": "S3Config.s3Properties", "symbol_class": "unknown", "lang": "java", "line_start": 24, "line_end": 24, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/config/s3/S3Config.java:java:field_declaration:S3Config.s3Properties:24-24", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Configuration\n@EnableConfigurationProperties(S3Properties.class)\n@RequiredArgsConstructor\npublic class S3Config {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.config.s3;\n\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.boot.context.properties.EnableConfigurationProperties;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport software.amazon.awssdk.auth.credentials.AwsBasicCredentials;\nimport software.amazon.awssdk.auth.credentials.StaticCredentialsProvider;\nimport software.amazon.awssdk.core.client.config.ClientOverrideConfiguration;\nimport software.amazon.awssdk.http.SdkHttpClient;\nimport software.amazon.awssdk.http.apache.ApacheHttpClient;\nimport software.amazon.awssdk.regions.Region;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.S3Configuration;\n\nimport java.net.URI;\nimport java.time.Duration;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "s3Client", "qualified_name": "S3Config.s3Client", "symbol_class": "method", "lang": "java", "line_start": 26, "line_end": 57, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/config/s3/S3Config.java:java:method_declaration:S3Config.s3Client:26-57", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Configuration\n@EnableConfigurationProperties(S3Properties.class)\n@RequiredArgsConstructor\npublic class S3Config {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.config.s3;\n\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.boot.context.properties.EnableConfigurationProperties;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport software.amazon.awssdk.auth.credentials.AwsBasicCredentials;\nimport software.amazon.awssdk.auth.credentials.StaticCredentialsProvider;\nimport software.amazon.awssdk.core.client.config.ClientOverrideConfiguration;\nimport software.amazon.awssdk.http.SdkHttpClient;\nimport software.amazon.awssdk.http.apache.ApacheHttpClient;\nimport software.amazon.awssdk.regions.Region;\nimport software.amazon.awssdk.services.s3.S3Client;\nimport software.amazon.awssdk.services.s3.S3Configuration;\n\nimport java.net.URI;\nimport java.time.Duration;"}], "path": "src/main/java/it/aredegalli/media/config/s3/S3Config.java"}}
{"id": "src/main/java/it/aredegalli/media/config/s3/S3Properties.java:java:0", "text": "package it.aredegalli.media.config.s3;\n\nimport lombok.Data;\nimport org.springframework.boot.context.properties.ConfigurationProperties;", "metadata": {"source_id": "src/main/java/it/aredegalli/media/config/s3/S3Properties.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.config.s3;", "preamble": true, "block_count": 1, "blocks_meta": [{"kind": "preamble", "lang": "java", "level": "parent", "package": "package it.aredegalli.media.config.s3;", "import_count": 2}], "path": "src/main/java/it/aredegalli/media/config/s3/S3Properties.java"}}
{"id": "src/main/java/it/aredegalli/media/config/s3/S3Properties.java:java:0", "text": "package it.aredegalli.media.config.s3;\n\nimport lombok.Data;\nimport org.springframework.boot.context.properties.ConfigurationProperties;\n\n@ConfigurationProperties(prefix = \"s3.config\")\n@Data\npublic class S3Properties {\n    // ... members ...\n}\n\n// ... code ...\n\nprivate String endpoint;\nprivate String accessKey;\nprivate String secretKey;\nprivate String region;", "metadata": {"source_id": "src/main/java/it/aredegalli/media/config/s3/S3Properties.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.config.s3;", "block_count": 4, "blocks_meta": [{"kind": "symbol_child", "node_type": "field_declaration", "symbol": "endpoint", "qualified_name": "S3Properties.endpoint", "symbol_class": "unknown", "lang": "java", "line_start": 9, "line_end": 9, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/config/s3/S3Properties.java:java:field_declaration:S3Properties.endpoint:9-9", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@ConfigurationProperties(prefix = \"s3.config\")\n@Data\npublic class S3Properties {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.config.s3;\n\nimport lombok.Data;\nimport org.springframework.boot.context.properties.ConfigurationProperties;"}, {"kind": "symbol_child", "node_type": "field_declaration", "symbol": "accessKey", "qualified_name": "S3Properties.accessKey", "symbol_class": "unknown", "lang": "java", "line_start": 10, "line_end": 10, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/config/s3/S3Properties.java:java:field_declaration:S3Properties.accessKey:10-10", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@ConfigurationProperties(prefix = \"s3.config\")\n@Data\npublic class S3Properties {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.config.s3;\n\nimport lombok.Data;\nimport org.springframework.boot.context.properties.ConfigurationProperties;"}, {"kind": "symbol_child", "node_type": "field_declaration", "symbol": "secretKey", "qualified_name": "S3Properties.secretKey", "symbol_class": "unknown", "lang": "java", "line_start": 11, "line_end": 11, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/config/s3/S3Properties.java:java:field_declaration:S3Properties.secretKey:11-11", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@ConfigurationProperties(prefix = \"s3.config\")\n@Data\npublic class S3Properties {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.config.s3;\n\nimport lombok.Data;\nimport org.springframework.boot.context.properties.ConfigurationProperties;"}, {"kind": "symbol_child", "node_type": "field_declaration", "symbol": "region", "qualified_name": "S3Properties.region", "symbol_class": "unknown", "lang": "java", "line_start": 12, "line_end": 12, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/config/s3/S3Properties.java:java:field_declaration:S3Properties.region:12-12", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@ConfigurationProperties(prefix = \"s3.config\")\n@Data\npublic class S3Properties {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.config.s3;\n\nimport lombok.Data;\nimport org.springframework.boot.context.properties.ConfigurationProperties;"}], "path": "src/main/java/it/aredegalli/media/config/s3/S3Properties.java"}}
{"id": "src/main/java/it/aredegalli/media/service/component/ResourceSecureDownloadService.java:java:0", "text": "package it.aredegalli.media.service.component;\n\nimport com.auth0.jwt.JWT;\nimport com.auth0.jwt.JWTVerifier;\nimport com.auth0.jwt.algorithms.Algorithm;\nimport com.auth0.jwt.exceptions.JWTVerificationException;\nimport com.auth0.jwt.interfaces.DecodedJWT;\nimport it.aredegalli.media.dto.SecuredResourceResponseDto;\nimport it.aredegalli.media.service.redis.RedisService;\nimport jakarta.annotation.PostConstruct;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport java.time.Duration;\nimport java.util.Date;", "metadata": {"source_id": "src/main/java/it/aredegalli/media/service/component/ResourceSecureDownloadService.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.service.component;", "preamble": true, "block_count": 1, "blocks_meta": [{"kind": "preamble", "lang": "java", "level": "parent", "package": "package it.aredegalli.media.service.component;", "import_count": 13}], "path": "src/main/java/it/aredegalli/media/service/component/ResourceSecureDownloadService.java"}}
{"id": "src/main/java/it/aredegalli/media/service/component/ResourceSecureDownloadService.java:java:0", "text": "package it.aredegalli.media.service.component;\n\nimport com.auth0.jwt.JWT;\nimport com.auth0.jwt.JWTVerifier;\nimport com.auth0.jwt.algorithms.Algorithm;\nimport com.auth0.jwt.exceptions.JWTVerificationException;\nimport com.auth0.jwt.interfaces.DecodedJWT;\nimport it.aredegalli.media.dto.SecuredResourceResponseDto;\nimport it.aredegalli.media.service.redis.RedisService;\nimport jakarta.annotation.PostConstruct;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport java.time.Duration;\nimport java.util.Date;\n\n@Component\n@RequiredArgsConstructor\npublic class ResourceSecureDownloadService {\n    // ... members ...\n}\n\n// ... code ...\n\n@Value(\"${jwt.secret}\")\n    private String jwtSecret;\n@Value(\"${jwt.expiration:300}\")\n    private int tokenExpirationSeconds;\nprivate Algorithm algorithm;\nprivate final RedisService redisService;\n@PostConstruct\n    private void initAlgorithm() {\n        this.algorithm = Algorithm.HMAC256(jwtSecret);\n    }\n/**\n     * Genera un token di download sicuro per una risorsa specifica\n     */\npublic String generateSecureDownloadToken(String resourceId, String bucketName) {\n        Date now = new Date();\n        Date expiration = new Date(now.getTime() + (tokenExpirationSeconds * 1000L));\n        return JWT.create()\n                .withIssuer(\"media-storage-be\")\n                .withSubject(resourceId)\n                .withClaim(\"bucketName\", bucketName)\n                .withIssuedAt(now)\n                .withExpiresAt(expiration)\n                .sign(algorithm);\n    }\n/**\n     * Valida il token e restituisce i dati della risorsa\n     */\npublic SecuredResourceResponseDto validateTokenAndExtractResourceId(String token) {\n        if (this.redisService.getValue(token) != null) {\n            throw new JWTVerificationException(\"Token has been revoked\");\n        }\n        JWTVerifier verifier = JWT.require(algorithm)\n                .withIssuer(\"media-storage-be\")\n                .build();\n        DecodedJWT jwt = verifier.verify(token);\n        this.redisService.setValue(token, true, Duration.ofSeconds(this.tokenExpirationSeconds));\n        return SecuredResourceResponseDto.builder()\n                .key(jwt.getSubject())\n                .bucket(jwt.getClaim(\"bucketName\").asString())\n                .build();\n    }", "metadata": {"source_id": "src/main/java/it/aredegalli/media/service/component/ResourceSecureDownloadService.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.service.component;", "block_count": 7, "blocks_meta": [{"kind": "symbol_child", "node_type": "field_declaration", "symbol": "jwtSecret", "qualified_name": "ResourceSecureDownloadService.jwtSecret", "symbol_class": "unknown", "lang": "java", "line_start": 22, "line_end": 23, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/component/ResourceSecureDownloadService.java:java:field_declaration:ResourceSecureDownloadService.jwtSecret:22-23", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Component\n@RequiredArgsConstructor\npublic class ResourceSecureDownloadService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.component;\n\nimport com.auth0.jwt.JWT;\nimport com.auth0.jwt.JWTVerifier;\nimport com.auth0.jwt.algorithms.Algorithm;\nimport com.auth0.jwt.exceptions.JWTVerificationException;\nimport com.auth0.jwt.interfaces.DecodedJWT;\nimport it.aredegalli.media.dto.SecuredResourceResponseDto;\nimport it.aredegalli.media.service.redis.RedisService;\nimport jakarta.annotation.PostConstruct;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport java.time.Duration;\nimport java.util.Date;"}, {"kind": "symbol_child", "node_type": "field_declaration", "symbol": "tokenExpirationSeconds", "qualified_name": "ResourceSecureDownloadService.tokenExpirationSeconds", "symbol_class": "unknown", "lang": "java", "line_start": 25, "line_end": 26, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/component/ResourceSecureDownloadService.java:java:field_declaration:ResourceSecureDownloadService.tokenExpirationSeconds:25-26", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Component\n@RequiredArgsConstructor\npublic class ResourceSecureDownloadService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.component;\n\nimport com.auth0.jwt.JWT;\nimport com.auth0.jwt.JWTVerifier;\nimport com.auth0.jwt.algorithms.Algorithm;\nimport com.auth0.jwt.exceptions.JWTVerificationException;\nimport com.auth0.jwt.interfaces.DecodedJWT;\nimport it.aredegalli.media.dto.SecuredResourceResponseDto;\nimport it.aredegalli.media.service.redis.RedisService;\nimport jakarta.annotation.PostConstruct;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport java.time.Duration;\nimport java.util.Date;"}, {"kind": "symbol_child", "node_type": "field_declaration", "symbol": "algorithm", "qualified_name": "ResourceSecureDownloadService.algorithm", "symbol_class": "unknown", "lang": "java", "line_start": 28, "line_end": 28, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/component/ResourceSecureDownloadService.java:java:field_declaration:ResourceSecureDownloadService.algorithm:28-28", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Component\n@RequiredArgsConstructor\npublic class ResourceSecureDownloadService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.component;\n\nimport com.auth0.jwt.JWT;\nimport com.auth0.jwt.JWTVerifier;\nimport com.auth0.jwt.algorithms.Algorithm;\nimport com.auth0.jwt.exceptions.JWTVerificationException;\nimport com.auth0.jwt.interfaces.DecodedJWT;\nimport it.aredegalli.media.dto.SecuredResourceResponseDto;\nimport it.aredegalli.media.service.redis.RedisService;\nimport jakarta.annotation.PostConstruct;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport java.time.Duration;\nimport java.util.Date;"}, {"kind": "symbol_child", "node_type": "field_declaration", "symbol": "redisService", "qualified_name": "ResourceSecureDownloadService.redisService", "symbol_class": "unknown", "lang": "java", "line_start": 30, "line_end": 30, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/component/ResourceSecureDownloadService.java:java:field_declaration:ResourceSecureDownloadService.redisService:30-30", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Component\n@RequiredArgsConstructor\npublic class ResourceSecureDownloadService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.component;\n\nimport com.auth0.jwt.JWT;\nimport com.auth0.jwt.JWTVerifier;\nimport com.auth0.jwt.algorithms.Algorithm;\nimport com.auth0.jwt.exceptions.JWTVerificationException;\nimport com.auth0.jwt.interfaces.DecodedJWT;\nimport it.aredegalli.media.dto.SecuredResourceResponseDto;\nimport it.aredegalli.media.service.redis.RedisService;\nimport jakarta.annotation.PostConstruct;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport java.time.Duration;\nimport java.util.Date;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "initAlgorithm", "qualified_name": "ResourceSecureDownloadService.initAlgorithm", "symbol_class": "method", "lang": "java", "line_start": 32, "line_end": 35, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/component/ResourceSecureDownloadService.java:java:method_declaration:ResourceSecureDownloadService.initAlgorithm:32-35", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@Component\n@RequiredArgsConstructor\npublic class ResourceSecureDownloadService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.component;\n\nimport com.auth0.jwt.JWT;\nimport com.auth0.jwt.JWTVerifier;\nimport com.auth0.jwt.algorithms.Algorithm;\nimport com.auth0.jwt.exceptions.JWTVerificationException;\nimport com.auth0.jwt.interfaces.DecodedJWT;\nimport it.aredegalli.media.dto.SecuredResourceResponseDto;\nimport it.aredegalli.media.service.redis.RedisService;\nimport jakarta.annotation.PostConstruct;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport java.time.Duration;\nimport java.util.Date;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "generateSecureDownloadToken", "qualified_name": "ResourceSecureDownloadService.generateSecureDownloadToken", "symbol_class": "method", "lang": "java", "line_start": 40, "line_end": 51, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/component/ResourceSecureDownloadService.java:java:method_declaration:ResourceSecureDownloadService.generateSecureDownloadToken:40-51", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "@Component\n@RequiredArgsConstructor\npublic class ResourceSecureDownloadService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.component;\n\nimport com.auth0.jwt.JWT;\nimport com.auth0.jwt.JWTVerifier;\nimport com.auth0.jwt.algorithms.Algorithm;\nimport com.auth0.jwt.exceptions.JWTVerificationException;\nimport com.auth0.jwt.interfaces.DecodedJWT;\nimport it.aredegalli.media.dto.SecuredResourceResponseDto;\nimport it.aredegalli.media.service.redis.RedisService;\nimport jakarta.annotation.PostConstruct;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport java.time.Duration;\nimport java.util.Date;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "validateTokenAndExtractResourceId", "qualified_name": "ResourceSecureDownloadService.validateTokenAndExtractResourceId", "symbol_class": "method", "lang": "java", "line_start": 56, "line_end": 73, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/component/ResourceSecureDownloadService.java:java:method_declaration:ResourceSecureDownloadService.validateTokenAndExtractResourceId:56-73", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "@Component\n@RequiredArgsConstructor\npublic class ResourceSecureDownloadService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.component;\n\nimport com.auth0.jwt.JWT;\nimport com.auth0.jwt.JWTVerifier;\nimport com.auth0.jwt.algorithms.Algorithm;\nimport com.auth0.jwt.exceptions.JWTVerificationException;\nimport com.auth0.jwt.interfaces.DecodedJWT;\nimport it.aredegalli.media.dto.SecuredResourceResponseDto;\nimport it.aredegalli.media.service.redis.RedisService;\nimport jakarta.annotation.PostConstruct;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport java.time.Duration;\nimport java.util.Date;"}], "path": "src/main/java/it/aredegalli/media/service/component/ResourceSecureDownloadService.java"}}
{"id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:0", "text": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;", "metadata": {"source_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.service.redis;", "preamble": true, "block_count": 1, "blocks_meta": [{"kind": "preamble", "lang": "java", "level": "parent", "package": "package it.aredegalli.media.service.redis;", "import_count": 12}], "path": "src/main/java/it/aredegalli/media/service/redis/RedisService.java"}}
{"id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:0", "text": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;\n\n/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}\n\n// ... code ...\n\nprivate final RedisTemplate<String, Object> redisTemplate;\n/**\n     * Salva un valore semplice con TTL.\n     * Perfetto per token temporanei, OTP, sessioni.\n     */\npublic void setValue(String key, Object value, Duration ttl) {\n        ValueOperations<String, Object> ops = redisTemplate.opsForValue();\n        ops.set(key, value, ttl);\n        log.info(\"Salvato {} in Redis con TTL di {} secondi\", key, ttl.getSeconds());\n    }\n/**\n     * Recupera un valore e restituisce null se non esiste o è scaduto.\n     */\npublic Object getValue(String key) {\n        return redisTemplate.opsForValue().get(key);\n    }\n/**\n     * Implementa un contatore distribuito atomico.\n     *\n     * Questo è molto utile nei microservizi per:\n     * - Rate limiting (es: max 100 richieste per minuto)\n     * - Conteggio visite/eventi\n     * - Implementare lock distribuiti\n     *\n     * L'operazione è atomica, quindi safe in ambiente distribuito!\n     */\npublic Long increment(String key) {\n        return redisTemplate.opsForValue().increment(key);\n    }\n/**\n     * Incrementa con TTL automatico.\n     * Perfetto per rate limiting con finestre temporali.\n     *\n     * Esempio: limitare le richieste di un utente a 100 al minuto.\n     */\npublic Long incrementWithExpiry(String key, Duration ttl) {\n        Long count = redisTemplate.opsForValue().increment(key);\n        // Imposta TTL solo se è la prima volta (count == 1)\n        // Questo crea una finestra temporale che si resetta automaticamente\n        if (count != null && count == 1) {\n            redisTemplate.expire(key, ttl);\n        }\n        return count;\n    }\n/**\n     * Rate limiting pratico: verifica se un'azione è permessa.\n     *\n     * @param userId ID dell'utente\n     * @param maxRequests Numero massimo di richieste\n     * @param window Finestra temporale\n     * @return true se l'azione è permessa, false se limite superato\n     */\npublic boolean checkRateLimit(String userId, int maxRequests, Duration window) {\n        String key = \"rate_limit:\" + userId;\n        Long currentCount = incrementWithExpiry(key, window);\n        boolean allowed = currentCount != null && currentCount <= maxRequests;\n        if (!allowed) {\n            log.warn(\"Rate limit superato per utente {}: {} richieste\", userId, currentCount);\n        }\n        return allowed;\n    }\n/**\n     * Salva un oggetto come hash in Redis.\n     *\n     * Gli hash sono perfetti quando hai un oggetto con molti campi\n     * e vuoi aggiornare/recuperare singoli campi senza caricare tutto.\n     *\n     * Esempio: profilo utente dove aggiorni solo alcuni campi.\n     */\npublic void saveHash(String key, Map<String, Object> data) {\n        redisTemplate.opsForHash().putAll(key, data);\n        log.info(\"Salvato hash {} con {} campi\", key, data.size());\n    }\n/**\n     * Recupera un singolo campo da un hash.\n     * Molto più efficiente che recuperare tutto l'oggetto!\n     */\npublic Object getHashField(String key, String field) {\n        return redisTemplate.opsForHash().get(key, field);\n    }\n/**\n     * Recupera tutto l'hash come mappa.\n     */\npublic Map<Object, Object> getHash(String key) {\n        return redisTemplate.opsForHash().entries(key);\n    }\n/**\n     * Incrementa un campo numerico in un hash.\n     * Utile per statistiche aggregate (es: views, likes, shares).\n     */\npublic Long incrementHashField(String key, String field, long delta) {\n        return redisTemplate.opsForHash().increment(key, field, delta);\n    }\n/**\n     * Aggiunge elementi a un set.\n     *\n     * I set sono perfetti per:\n     * - Gestire utenti online\n     * - Tag/categorie\n     * - Elementi unici senza duplicati\n     */\npublic void addToSet(String key, Object... values) {\n        SetOperations<String, Object> ops = redisTemplate.opsForSet();\n        ops.add(key, values);\n        log.info(\"Aggiunti {} elementi al set {}\", values.length, key);\n    }\n/**\n     * Verifica se un elemento è nel set.\n     * Operazione O(1) estremamente veloce!\n     */\npublic Boolean isMemberOfSet(String key, Object value) {\n        return redisTemplate.opsForSet().isMember(key, value);\n    }\n/**\n     * Restituisce tutti i membri del set.\n     */\npublic Set<Object> getSetMembers(String key) {\n        return redisTemplate.opsForSet().members(key);\n    }\n/**\n     * Rimuove elementi dal set.\n     */\npublic void removeFromSet(String key, Object... values) {\n        redisTemplate.opsForSet().remove(key, values);\n    }\n/**\n     * Esempio pratico: gestione utenti online.\n     * Aggiungi utente quando fa login, rimuovi al logout.\n     */\npublic void markUserOnline(String userId) {\n        addToSet(\"users:online\", userId);\n        // Opzionale: aggiungi TTL per auto-cleanup se l'app crasha\n        redisTemplate.expire(\"users:online\", Duration.ofHours(1));\n    }\npublic void markUserOffline(String userId) {\n        removeFromSet(\"users:online\", userId);\n    }\npublic boolean isUserOnline(String userId) {\n        return Boolean.TRUE.equals(isMemberOfSet(\"users:online\", userId));\n    }\n/**\n     * Aggiunge un elemento con uno score a un sorted set.\n     *\n     * I sorted set sono incredibilmente versatili:\n     * - Leaderboard/classifiche (score = punteggio)\n     * - Timeline ordinate (score = timestamp)\n     * - Priority queue (score = priorità)\n     * - Range query efficienti\n     */\npublic void addToSortedSet(String key, Object value, double score) {\n        ZSetOperations<String, Object> ops = redisTemplate.opsForZSet();\n        ops.add(key, value, score);\n    }\n/**\n     * Recupera i top N elementi (con score più alto).\n     * Perfetto per leaderboard!\n     */\npublic Set<Object> getTopN(String key, int n) {\n        ZSetOperations<String, Object> ops = redisTemplate.opsForZSet();\n        // reverseRange restituisce in ordine decrescente (dal più alto al più basso)\n        return ops.reverseRange(key, 0, n - 1);\n    }\n/**\n     * Recupera la posizione (rank) di un elemento.\n     * 0 = primo posto, 1 = secondo posto, ecc.\n     */\npublic Long getRank(String key, Object value) {\n        ZSetOperations<String, Object> ops = redisTemplate.opsForZSet();\n        // reverseRank per avere 0 = score più alto\n        return ops.reverseRank(key, value);\n    }\n/**\n     * Incrementa lo score di un elemento.\n     * Utile per aggiornare punteggi in tempo reale.\n     */\npublic Double incrementScore(String key, Object value, double delta) {\n        return redisTemplate.opsForZSet().incrementScore(key, value, delta);\n    }", "metadata": {"source_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.service.redis;", "block_count": 21, "blocks_meta": [{"kind": "symbol_child", "node_type": "field_declaration", "symbol": "redisTemplate", "qualified_name": "RedisService.redisTemplate", "symbol_class": "unknown", "lang": "java", "line_start": 34, "line_end": 34, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:field_declaration:RedisService.redisTemplate:34-34", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "setValue", "qualified_name": "RedisService.setValue", "symbol_class": "method", "lang": "java", "line_start": 42, "line_end": 46, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.setValue:42-46", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "getValue", "qualified_name": "RedisService.getValue", "symbol_class": "method", "lang": "java", "line_start": 51, "line_end": 53, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.getValue:51-53", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "increment", "qualified_name": "RedisService.increment", "symbol_class": "method", "lang": "java", "line_start": 65, "line_end": 67, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.increment:65-67", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "incrementWithExpiry", "qualified_name": "RedisService.incrementWithExpiry", "symbol_class": "method", "lang": "java", "line_start": 75, "line_end": 85, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.incrementWithExpiry:75-85", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "checkRateLimit", "qualified_name": "RedisService.checkRateLimit", "symbol_class": "method", "lang": "java", "line_start": 95, "line_end": 106, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.checkRateLimit:95-106", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "saveHash", "qualified_name": "RedisService.saveHash", "symbol_class": "method", "lang": "java", "line_start": 118, "line_end": 121, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.saveHash:118-121", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "getHashField", "qualified_name": "RedisService.getHashField", "symbol_class": "method", "lang": "java", "line_start": 127, "line_end": 129, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.getHashField:127-129", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "getHash", "qualified_name": "RedisService.getHash", "symbol_class": "method", "lang": "java", "line_start": 134, "line_end": 136, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.getHash:134-136", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "incrementHashField", "qualified_name": "RedisService.incrementHashField", "symbol_class": "method", "lang": "java", "line_start": 142, "line_end": 144, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.incrementHashField:142-144", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "addToSet", "qualified_name": "RedisService.addToSet", "symbol_class": "method", "lang": "java", "line_start": 156, "line_end": 160, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.addToSet:156-160", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "isMemberOfSet", "qualified_name": "RedisService.isMemberOfSet", "symbol_class": "method", "lang": "java", "line_start": 166, "line_end": 168, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.isMemberOfSet:166-168", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "getSetMembers", "qualified_name": "RedisService.getSetMembers", "symbol_class": "method", "lang": "java", "line_start": 173, "line_end": 175, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.getSetMembers:173-175", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "removeFromSet", "qualified_name": "RedisService.removeFromSet", "symbol_class": "method", "lang": "java", "line_start": 180, "line_end": 182, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.removeFromSet:180-182", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "markUserOnline", "qualified_name": "RedisService.markUserOnline", "symbol_class": "method", "lang": "java", "line_start": 188, "line_end": 192, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.markUserOnline:188-192", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "markUserOffline", "qualified_name": "RedisService.markUserOffline", "symbol_class": "method", "lang": "java", "line_start": 194, "line_end": 196, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.markUserOffline:194-196", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "isUserOnline", "qualified_name": "RedisService.isUserOnline", "symbol_class": "method", "lang": "java", "line_start": 198, "line_end": 200, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.isUserOnline:198-200", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "addToSortedSet", "qualified_name": "RedisService.addToSortedSet", "symbol_class": "method", "lang": "java", "line_start": 213, "line_end": 216, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.addToSortedSet:213-216", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "getTopN", "qualified_name": "RedisService.getTopN", "symbol_class": "method", "lang": "java", "line_start": 222, "line_end": 226, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.getTopN:222-226", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "getRank", "qualified_name": "RedisService.getRank", "symbol_class": "method", "lang": "java", "line_start": 232, "line_end": 236, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.getRank:232-236", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "incrementScore", "qualified_name": "RedisService.incrementScore", "symbol_class": "method", "lang": "java", "line_start": 242, "line_end": 244, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.incrementScore:242-244", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}], "path": "src/main/java/it/aredegalli/media/service/redis/RedisService.java"}}
{"id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:1", "text": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;\n\n/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}\n\n// ... code ...\n\n/**\n     * Recupera la posizione (rank) di un elemento.\n     * 0 = primo posto, 1 = secondo posto, ecc.\n     */\npublic Long getRank(String key, Object value) {\n        ZSetOperations<String, Object> ops = redisTemplate.opsForZSet();\n        // reverseRank per avere 0 = score più alto\n        return ops.reverseRank(key, value);\n    }\n/**\n     * Incrementa lo score di un elemento.\n     * Utile per aggiornare punteggi in tempo reale.\n     */\npublic Double incrementScore(String key, Object value, double delta) {\n        return redisTemplate.opsForZSet().incrementScore(key, value, delta);\n    }\n/**\n     * Esempio pratico: leaderboard di un gioco.\n     */\npublic void updatePlayerScore(String playerId, long points) {\n        String leaderboardKey = \"leaderboard:global\";\n        incrementScore(leaderboardKey, playerId, points);\n        log.info(\"Aggiornato punteggio per player {}: +{} punti\", playerId, points);\n    }\npublic List<String> getTopPlayers(int limit) {\n        String leaderboardKey = \"leaderboard:global\";\n        Set<Object> top = getTopN(leaderboardKey, limit);\n        return top.stream()\n            .map(Object::toString)\n            .toList();\n    }\n/**\n     * Aggiunge elementi alla fine di una lista (come una coda).\n     * Perfetto per job queue, message queue, log buffer.\n     */\npublic void pushToList(String key, Object... values) {\n        redisTemplate.opsForList().rightPushAll(key, values);\n    }\n/**\n     * Rimuove e restituisce il primo elemento (FIFO).\n     * Perfetto per consumare messaggi da una queue.\n     */\npublic Object popFromList(String key) {\n        return redisTemplate.opsForList().leftPop(key);\n    }\n/**\n     * Operazione di blocking pop: attende fino a quando un elemento è disponibile.\n     * Questo è PERFETTO per worker che processano job da una queue!\n     *\n     * @param key Chiave della lista\n     * @param timeout Timeout massimo di attesa\n     * @return L'elemento o null se timeout\n     */\npublic Object blockingPopFromList(String key, Duration timeout) {\n        return redisTemplate.opsForList().leftPop(key, timeout.getSeconds(), TimeUnit.SECONDS);\n    }\n/**\n     * Restituisce la dimensione della lista senza rimuovere elementi.\n     */\npublic Long getListSize(String key) {\n        return redisTemplate.opsForList().size(key);\n    }\n/**\n     * Elimina una o più chiavi.\n     */\npublic void delete(String... keys) {\n        redisTemplate.delete(List.of(keys));\n        log.info(\"Eliminate {} chiavi da Redis\", keys.length);\n    }\n/**\n     * Verifica se una chiave esiste.\n     */\npublic boolean exists(String key) {\n        return Boolean.TRUE.equals(redisTemplate.hasKey(key));\n    }\n/**\n     * Imposta TTL su una chiave esistente.\n     */\npublic void setExpiration(String key, Duration ttl) {\n        redisTemplate.expire(key, ttl);\n    }\n/**\n     * Recupera il TTL rimanente di una chiave (in secondi).\n     * Restituisce -1 se la chiave non ha TTL, -2 se non esiste.\n     */\npublic Long getTTL(String key) {\n        return redisTemplate.getExpire(key, TimeUnit.SECONDS);\n    }", "metadata": {"source_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media.service.redis;", "block_count": 12, "blocks_meta": [{"kind": "symbol_child", "node_type": "method_declaration", "symbol": "getRank", "qualified_name": "RedisService.getRank", "symbol_class": "method", "lang": "java", "line_start": 232, "line_end": 236, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.getRank:232-236", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "incrementScore", "qualified_name": "RedisService.incrementScore", "symbol_class": "method", "lang": "java", "line_start": 242, "line_end": 244, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.incrementScore:242-244", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "updatePlayerScore", "qualified_name": "RedisService.updatePlayerScore", "symbol_class": "method", "lang": "java", "line_start": 249, "line_end": 253, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.updatePlayerScore:249-253", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "getTopPlayers", "qualified_name": "RedisService.getTopPlayers", "symbol_class": "method", "lang": "java", "line_start": 255, "line_end": 261, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.getTopPlayers:255-261", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "pushToList", "qualified_name": "RedisService.pushToList", "symbol_class": "method", "lang": "java", "line_start": 269, "line_end": 271, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.pushToList:269-271", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "popFromList", "qualified_name": "RedisService.popFromList", "symbol_class": "method", "lang": "java", "line_start": 277, "line_end": 279, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.popFromList:277-279", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "blockingPopFromList", "qualified_name": "RedisService.blockingPopFromList", "symbol_class": "method", "lang": "java", "line_start": 289, "line_end": 291, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.blockingPopFromList:289-291", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "getListSize", "qualified_name": "RedisService.getListSize", "symbol_class": "method", "lang": "java", "line_start": 296, "line_end": 298, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.getListSize:296-298", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "delete", "qualified_name": "RedisService.delete", "symbol_class": "method", "lang": "java", "line_start": 305, "line_end": 308, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.delete:305-308", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "exists", "qualified_name": "RedisService.exists", "symbol_class": "method", "lang": "java", "line_start": 313, "line_end": 315, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.exists:313-315", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "setExpiration", "qualified_name": "RedisService.setExpiration", "symbol_class": "method", "lang": "java", "line_start": 320, "line_end": 322, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.setExpiration:320-322", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}, {"kind": "symbol_child", "node_type": "method_declaration", "symbol": "getTTL", "qualified_name": "RedisService.getTTL", "symbol_class": "method", "lang": "java", "line_start": 328, "line_end": 330, "level": "child", "parent_id": "src/main/java/it/aredegalli/media/service/redis/RedisService.java:java:method_declaration:RedisService.getTTL:328-330", "annotations": [], "has_javadoc": true, "child_index": 0, "_class_context": "/**\n * Servizio per operazioni avanzate su Redis usando RedisTemplate.\n * \n * Redis non è solo una cache key-value, ma supporta diverse strutture dati:\n * - String: valori semplici con TTL\n * - Hash: mappe annidate (perfette per oggetti con campi multipli)\n * - List: code FIFO/LIFO\n * - Set: collezioni uniche\n * - Sorted Set (ZSet): set ordinati per score\n * \n * Questo servizio mostra esempi pratici per ognuna di queste strutture.\n */\n@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class RedisService {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media.service.redis;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.data.redis.core.SetOperations;\nimport org.springframework.data.redis.core.ZSetOperations;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;"}], "path": "src/main/java/it/aredegalli/media/service/redis/RedisService.java"}}
{"id": "src/test/java/it/aredegalli/media/MediaStorageApplicationTests.java:java:0", "text": "package it.aredegalli.media;\n\nimport org.junit.jupiter.api.Test;\nimport org.springframework.boot.test.context.SpringBootTest;", "metadata": {"source_id": "src/test/java/it/aredegalli/media/MediaStorageApplicationTests.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media;", "preamble": true, "block_count": 1, "blocks_meta": [{"kind": "preamble", "lang": "java", "level": "parent", "package": "package it.aredegalli.media;", "import_count": 2}], "path": "src/test/java/it/aredegalli/media/MediaStorageApplicationTests.java"}}
{"id": "src/test/java/it/aredegalli/media/MediaStorageApplicationTests.java:java:0", "text": "package it.aredegalli.media;\n\nimport org.junit.jupiter.api.Test;\nimport org.springframework.boot.test.context.SpringBootTest;\n\n@SpringBootTest\nclass MediaStorageApplicationTests {\n    // ... members ...\n}\n\n// ... code ...\n\n@Test\n\tvoid contextLoads() {\n\t}", "metadata": {"source_id": "src/test/java/it/aredegalli/media/MediaStorageApplicationTests.java", "ext": ".java", "lang": "java", "chunker": "java", "package": "package it.aredegalli.media;", "block_count": 1, "blocks_meta": [{"kind": "symbol_child", "node_type": "method_declaration", "symbol": "contextLoads", "qualified_name": "MediaStorageApplicationTests.contextLoads", "symbol_class": "method", "lang": "java", "line_start": 9, "line_end": 11, "level": "child", "parent_id": "src/test/java/it/aredegalli/media/MediaStorageApplicationTests.java:java:method_declaration:MediaStorageApplicationTests.contextLoads:9-11", "annotations": [], "has_javadoc": false, "child_index": 0, "_class_context": "@SpringBootTest\nclass MediaStorageApplicationTests {\n    // ... members ...\n}", "_file_header": "package it.aredegalli.media;\n\nimport org.junit.jupiter.api.Test;\nimport org.springframework.boot.test.context.SpringBootTest;"}], "path": "src/test/java/it/aredegalli/media/MediaStorageApplicationTests.java"}}
